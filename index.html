<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Instituto San Marcos ‚Äî Portal Escolar</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --indigo:#4338CA; --violet:#7C3AED; --green:#059669; --teal:#0891B2;
  --amber:#D97706; --red:#DC2626; --pink:#DB2777;
  --sidebar:256px; --r:6px; --border:#E8EAED; --bg:#F4F6FB;
  --text:#0F172A; --muted:#64748B;
}
*,*::before,*::after{box-sizing:border-box;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);font-size:14px;color:var(--text);margin:0;}

/* ‚ïê‚ïê LOGIN ‚ïê‚ïê */
#loginScreen{position:fixed;inset:0;background:linear-gradient(135deg,#1e1b4b 0%,#312e81 40%,#4338ca 70%,#7c3aed 100%);display:flex;align-items:center;justify-content:center;z-index:9999;}
.login-box{background:#fff;border-radius:16px;padding:40px;width:100%;max-width:420px;box-shadow:0 25px 60px rgba(0,0,0,.3);}
.login-logo{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--indigo),var(--violet));display:flex;align-items:center;justify-content:center;color:#fff;font-size:22px;font-weight:800;margin:0 auto 16px;}
.login-title{text-align:center;font-size:20px;font-weight:800;margin-bottom:4px;}
.login-sub{text-align:center;font-size:13px;color:var(--muted);margin-bottom:28px;}
.role-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:24px;}
.role-card{border:2px solid var(--border);border-radius:8px;padding:12px 6px;text-align:center;cursor:pointer;transition:all .15s;}
.role-card:hover{border-color:var(--indigo);background:#F5F3FF;}
.role-card.sel{border-color:var(--indigo);background:#EEF2FF;}
.role-card .ri{font-size:22px;display:block;margin-bottom:4px;}
.role-card .rl{font-size:11px;font-weight:700;}
.login-err{background:#FEF2F2;border:1px solid #FEE2E2;border-radius:var(--r);padding:10px 14px;color:var(--red);font-size:12px;margin-bottom:16px;display:none;}
.btn-login{width:100%;background:linear-gradient(135deg,var(--indigo),var(--violet));color:#fff;border:none;border-radius:var(--r);padding:11px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;transition:opacity .15s;}
.btn-login:hover{opacity:.9;}
.demo-hint{margin-top:16px;background:#F8FAFC;border-radius:var(--r);padding:12px;font-size:11px;color:var(--muted);}
.demo-hint b{color:var(--text);}

/* ‚ïê‚ïê PORTAL ‚ïê‚ïê */
#portalScreen{display:none;}
#sidebar{width:var(--sidebar);min-height:100vh;background:#fff;border-right:1px solid var(--border);position:fixed;top:0;left:0;bottom:0;z-index:200;display:flex;flex-direction:column;transition:transform .25s;}
.sidebar-logo{padding:16px 14px 13px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.logo-box{width:34px;height:34px;border-radius:8px;background:linear-gradient(135deg,var(--indigo),var(--violet));display:flex;align-items:center;justify-content:center;color:#fff;font-size:15px;font-weight:800;flex-shrink:0;}
.logo-name{font-size:12px;font-weight:800;line-height:1.2;}
.logo-sub{font-size:10px;color:var(--muted);}
.sidebar-user{padding:11px 13px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:9px;}
.user-av{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;color:#fff;flex-shrink:0;}
.uav-admin{background:linear-gradient(135deg,#059669,#0891B2);}
.uav-maestro{background:linear-gradient(135deg,#D97706,#DC2626);}
.uav-alumno{background:linear-gradient(135deg,#4338CA,#7C3AED);}
.user-name{font-size:12px;font-weight:700;}
.user-sub{font-size:10px;color:var(--muted);}
.nav-label{font-size:9px;font-weight:800;text-transform:uppercase;letter-spacing:.8px;color:#CBD5E1;padding:10px 15px 3px;}
.nav-item{display:flex;align-items:center;gap:8px;padding:7px 11px;border-radius:var(--r);margin:0 7px 1px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;transition:all .12s;border:none;background:none;width:calc(100% - 14px);text-align:left;}
.nav-item:hover{background:var(--bg);color:var(--text);}
.nav-item.active{background:#EEF2FF;color:var(--indigo);}
.nav-item.active.green{background:#ECFDF5;color:var(--green);}
.nav-item.active.amber{background:#FFFBEB;color:var(--amber);}
.nav-item .ni{font-size:14px;width:18px;text-align:center;flex-shrink:0;}
.nav-badge{margin-left:auto;font-size:9px;font-weight:700;padding:1px 6px;border-radius:99px;background:var(--indigo);color:#fff;}
#sidebarNav{flex:1;overflow-y:auto;padding:6px 0;}
.sidebar-footer{padding:9px;border-top:1px solid var(--border);}
.btn-logout{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:var(--r);font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;border:none;background:none;width:100%;transition:all .12s;font-family:inherit;}
.btn-logout:hover{background:#FEF2F2;color:var(--red);}
#mainWrapper{margin-left:var(--sidebar);min-height:100vh;}
.topbar{background:#fff;height:54px;padding:0 22px;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;}
.topbar-title{font-size:14px;font-weight:800;}
.topbar-right{display:flex;align-items:center;gap:8px;}
#pageContent{padding:20px 22px 48px;}

/* ‚ïê‚ïê CARDS ‚ïê‚ïê */
.card-base{background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:0 1px 4px rgba(0,0,0,.05);transition:box-shadow .15s;}
.card-base:hover{box-shadow:0 4px 14px rgba(0,0,0,.08);}
.chr{padding:13px 17px 11px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.ct{font-size:13px;font-weight:700;}
.cbp{padding:15px 17px;}
.stat-card{background:#fff;border-radius:var(--r);padding:16px;border:1px solid var(--border);box-shadow:0 1px 4px rgba(0,0,0,.05);}
.stat-top{height:3px;border-radius:2px;margin-bottom:12px;}
.stat-val{font-size:22px;font-weight:800;line-height:1;}
.stat-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);margin-top:3px;}
.stat-sub{font-size:11px;margin-top:5px;}

/* ‚ïê‚ïê HERO CARD ‚ïê‚ïê */
.acct-hero{border-radius:var(--r);padding:22px;color:#fff;position:relative;overflow:hidden;margin-bottom:16px;}
.acct-hero::before{content:'';position:absolute;top:-50px;right:-50px;width:160px;height:160px;border-radius:50%;background:rgba(255,255,255,.06);}
.acct-hero::after{content:'';position:absolute;bottom:-70px;right:70px;width:130px;height:130px;border-radius:50%;background:rgba(255,255,255,.04);}
.hero-type{font-size:10px;opacity:.6;text-transform:uppercase;letter-spacing:1.2px;}
.hero-num{font-size:11px;opacity:.5;letter-spacing:2px;margin-top:2px;font-family:'JetBrains Mono',monospace;}
.hero-name{font-size:24px;font-weight:800;line-height:1;margin-top:10px;}
.hero-meta{display:flex;gap:20px;margin-top:12px;position:relative;z-index:1;}
.hero-kv{display:flex;flex-direction:column;gap:2px;}
.hero-k{font-size:10px;opacity:.6;}
.hero-v{font-size:16px;font-weight:800;}

/* ‚ïê‚ïê TABLE ‚ïê‚ïê */
.tbl{width:100%;border-collapse:collapse;font-size:13px;}
.tbl th{padding:8px 13px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);background:#F8FAFC;border-bottom:1px solid var(--border);text-align:left;white-space:nowrap;}
.tbl td{padding:9px 13px;border-bottom:1px solid #F1F5F9;vertical-align:middle;}
.tbl tr:hover td{background:#FAFBFF;}
.tbl tr:last-child td{border-bottom:none;}

/* ‚ïê‚ïê BADGES ‚ïê‚ïê */
.bd{display:inline-flex;align-items:center;font-size:10px;font-weight:700;padding:2px 8px;border-radius:99px;}
.bd-green{background:#D1FAE5;color:#065F46;}
.bd-blue{background:#E0E7FF;color:#3730A3;}
.bd-amber{background:#FEF3C7;color:#92400E;}
.bd-red{background:#FEE2E2;color:#991B1B;}
.bd-gray{background:#F1F5F9;color:#475569;}
.bd-violet{background:#EDE9FE;color:#5B21B6;}
.bd-teal{background:#CFFAFE;color:#155E75;}
.bd-pink{background:#FCE7F3;color:#9D174D;}

/* ‚ïê‚ïê CALIFICACION BOX ‚ïê‚ïê */
.cal-box{width:38px;height:38px;border-radius:var(--r);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;flex-shrink:0;}
.cal-a{background:#D1FAE5;color:#065F46;}
.cal-b{background:#E0E7FF;color:#3730A3;}
.cal-c{background:#FEF3C7;color:#92400E;}
.cal-d{background:#FEE2E2;color:#991B1B;}

/* ‚ïê‚ïê ROW LIST ‚ïê‚ïê */
.tx-row{display:flex;align-items:center;gap:10px;padding:9px 17px;border-bottom:1px solid #F8FAFC;transition:background .1s;}
.tx-row:last-child{border-bottom:none;}
.tx-row:hover{background:#FAFAFA;}
.tx-ico{width:32px;height:32px;border-radius:var(--r);display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;}

/* ‚ïê‚ïê NOTICE ‚ïê‚ïê */
.notice-item{display:flex;gap:11px;padding:11px 17px;border-bottom:1px solid #F8FAFC;}
.notice-item:last-child{border-bottom:none;}
.notice-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:5px;}

/* ‚ïê‚ïê PROGRESS ‚ïê‚ïê */
.prog-wrap{height:6px;background:#F1F5F9;border-radius:3px;overflow:hidden;}
.prog-bar{height:100%;border-radius:3px;transition:width .5s ease;}

/* ‚ïê‚ïê HORARIO GRID ‚ïê‚ïê */
.sch-grid{display:grid;grid-template-columns:56px repeat(5,1fr);gap:3px;font-size:10px;}
.sch-head{padding:5px 3px;font-weight:800;text-align:center;text-transform:uppercase;color:var(--muted);font-size:9px;}
.sch-time{padding:4px;font-weight:600;text-align:center;color:var(--muted);font-family:'JetBrains Mono',monospace;font-size:9px;display:flex;align-items:center;justify-content:center;}
.sch-cell{padding:5px 3px;border-radius:4px;text-align:center;font-weight:700;min-height:46px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:9px;line-height:1.3;}
.sc-mat{background:#EEF2FF;color:#3730A3;}
.sc-cien{background:#D1FAE5;color:#065F46;}
.sc-hist{background:#FEF3C7;color:#92400E;}
.sc-ing{background:#FCE7F3;color:#9D174D;}
.sc-ed{background:#E0F2FE;color:#075985;}
.sc-arte{background:#EDE9FE;color:#5B21B6;}
.sc-esp{background:#FFF7ED;color:#C2410C;}
.sc-rec{background:#F8FAFC;color:#CBD5E1;}
.sc-tec{background:#ECFDF5;color:#065F46;}
.sc-fis{background:#FEF2F2;color:#991B1B;}

/* ‚ïê‚ïê FORMS ‚ïê‚ïê */
.form-label{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);margin-bottom:4px;}
.form-control,.form-select{border-radius:var(--r);border:1px solid var(--border);font-size:13px;font-family:'Plus Jakarta Sans',sans-serif;padding:7px 11px;}
.form-control:focus,.form-select:focus{border-color:var(--indigo);box-shadow:0 0 0 3px rgba(67,56,202,.1);outline:none;}
.form-control.is-invalid,.form-select.is-invalid{border-color:var(--red);background:#FFF5F5;}
.field-err{font-size:11px;color:var(--red);margin-top:3px;display:none;}
.field-err.show{display:block;}
.modal-alert{border-radius:var(--r);padding:10px 13px;font-size:12px;font-weight:600;margin-bottom:14px;display:none;}
.modal-alert.show{display:flex;align-items:center;gap:8px;}
.modal-alert.err{background:#FEF2F2;border:1px solid #FEE2E2;color:var(--red);}
.modal-alert.ok{background:#ECFDF5;border:1px solid #A7F3D0;color:#065F46;}
.modal-alert.warn{background:#FFFBEB;border:1px solid #FDE68A;color:#92400E;}

/* ‚ïê‚ïê BUTTONS ‚ïê‚ïê */
.btn-pri{background:var(--indigo);color:#fff;border:none;border-radius:var(--r);padding:7px 15px;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;transition:background .15s;}
.btn-pri:hover{background:#3730A3;}
.btn-green{background:var(--green)!important;}
.btn-green:hover{background:#047857!important;}
.btn-amber{background:var(--amber)!important;}
.btn-amber:hover{background:#B45309!important;}
.btn-teal{background:var(--teal)!important;}
.btn-teal:hover{background:#0369A1!important;}
.btn-red{background:var(--red)!important;}
.btn-red:hover{background:#B91C1C!important;}
.btn-sec{background:#fff;color:var(--text);border:1px solid var(--border);border-radius:var(--r);padding:7px 15px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s;}
.btn-sec:hover{background:var(--bg);}
.btn-sm{padding:4px 11px;font-size:12px;}
.btn-ico{width:28px;height:28px;border-radius:var(--r);border:1px solid var(--border);background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;transition:all .12s;}
.btn-ico:hover{background:var(--bg);}

/* ‚ïê‚ïê SEARCH ‚ïê‚ïê */
.sw{position:relative;}
.sw input{padding-left:31px;}
.sw .si{position:absolute;left:9px;top:50%;transform:translateY(-50%);color:var(--muted);font-size:13px;pointer-events:none;}

/* ‚ïê‚ïê MODAL ‚ïê‚ïê */
.modal-content{border-radius:8px;border:1px solid var(--border);box-shadow:0 10px 40px rgba(0,0,0,.13);}
.modal-header{padding:15px 19px 13px;border-bottom:1px solid var(--border);}
.modal-title{font-size:14px;font-weight:800;}
.modal-body{padding:19px;}
.modal-footer{padding:11px 19px;border-top:1px solid var(--border);}

/* ‚ïê‚ïê TOAST ‚ïê‚ïê */
#toast{position:fixed;top:20px;right:20px;z-index:99999;padding:12px 18px;border-radius:8px;font-size:13px;font-weight:700;box-shadow:0 8px 25px rgba(0,0,0,.15);transform:translateY(-80px);opacity:0;transition:all .35s cubic-bezier(.34,1.56,.64,1);pointer-events:none;display:flex;align-items:center;gap:9px;}
#toast.show{transform:translateY(0);opacity:1;}
#toast.t-ok{background:#ECFDF5;color:#065F46;border:1px solid #A7F3D0;}
#toast.t-err{background:#FEF2F2;color:#991B1B;border:1px solid #FEE2E2;}
#toast.t-warn{background:#FFFBEB;color:#92400E;border:1px solid #FDE68A;}

/* ‚ïê‚ïê MISC ‚ïê‚ïê */
.info-box{background:#EEF2FF;border:1px solid #C7D2FE;border-radius:var(--r);padding:9px 13px;color:#3730A3;font-size:11px;}
.warn-box{background:#FFFBEB;border:1px solid #FDE68A;border-radius:var(--r);padding:9px 13px;color:#92400E;font-size:11px;}
.section-hidden{display:none!important;}
.tab-bar{display:flex;gap:2px;border-bottom:2px solid var(--border);margin-bottom:18px;}
.tab-btn{padding:7px 15px;font-size:12px;font-weight:700;color:var(--muted);border:none;background:none;cursor:pointer;position:relative;transition:color .15s;font-family:inherit;}
.tab-btn.active{color:var(--indigo);}
.tab-btn.active::after{content:'';position:absolute;bottom:-2px;left:0;right:0;height:2px;background:var(--indigo);border-radius:1px;}
/* ‚ïê‚ïê OVERLAY ‚ïê‚ïê */
#menuToggleBtn{display:none;}
@media(max-width:767px){#menuToggleBtn{display:flex;}}
#sidebarOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:199;backdrop-filter:blur(2px);}
#sidebarOverlay.show{display:block;}

/* ‚ïê‚ïê RESPONSIVE ‚ïê‚ïê */
@media(max-width:991px){ :root{--sidebar:240px;} }

@media(max-width:767px){
  :root{--sidebar:272px;}
  #sidebar{transform:translateX(-100%);box-shadow:none;}
  #sidebar.open{transform:translateX(0);box-shadow:6px 0 30px rgba(0,0,0,.15);}
  #mainWrapper{margin-left:0!important;}
  .login-box{padding:28px 20px;margin:16px;}
  .role-cards{gap:6px;}
  .role-card{padding:10px 4px;}
  .role-card .ri{font-size:18px;}
  .topbar{padding:0 14px;}
  .topbar-title{font-size:13px;}
  #pageContent{padding:14px 12px 80px;}
  .stat-val{font-size:18px;}
  .tbl-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch;border-radius:var(--r);}
  .tbl{min-width:540px;}
  .acct-hero{padding:16px;}
  .hero-name{font-size:18px;}
  .hero-meta{flex-wrap:wrap;gap:12px;}
  .sch-grid{grid-template-columns:44px repeat(5,1fr);gap:2px;font-size:8px;}
  .sch-cell{min-height:38px;font-size:8px;padding:3px 2px;}
  .tab-bar{overflow-x:auto;-webkit-overflow-scrolling:touch;flex-wrap:nowrap;white-space:nowrap;scrollbar-width:none;padding-bottom:1px;}
  .tab-bar::-webkit-scrollbar{display:none;}
  .modal-dialog{margin:10px;}
  .modal-body{padding:14px;}
}

@media(max-width:480px){
  .login-box{padding:22px 16px;margin:10px;}
  .hero-name{font-size:16px;}
  .stat-val{font-size:16px;}
  .stat-card{padding:12px;}
}

/* ‚ïê‚ïê BOTTOM NAV M√ìVIL ‚ïê‚ïê */
#bottomNav{display:none;position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid var(--border);z-index:150;padding:6px 0 env(safe-area-inset-bottom,6px);box-shadow:0 -4px 20px rgba(0,0,0,.08);}
#bottomNav .bn-items{display:flex;justify-content:space-around;align-items:center;}
#bottomNav .bn-item{display:flex;flex-direction:column;align-items:center;gap:3px;padding:4px 10px;border:none;background:none;cursor:pointer;font-family:inherit;color:var(--muted);font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.3px;transition:color .15s;min-width:52px;}
#bottomNav .bn-item i{font-size:19px;}
#bottomNav .bn-item.active{color:var(--indigo);}
#bottomNav .bn-item.active.amber{color:var(--amber);}
@media(max-width:767px){#bottomNav{display:block;}}

/* ‚ïê‚ïê ACCESIBILIDAD WCAG 2.1 ‚ïê‚ïê */
:focus-visible{outline:3px solid var(--indigo);outline-offset:2px;}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
[role="button"], button{cursor:pointer;}
.high-contrast:root{--text:#000000;--bg:#FFFFFF;--border:#000000;}
</style>
</head>
<body>

<div id="toast" role="status" aria-live="polite"><i id="toastIcon" class="bi bi-check-circle-fill" aria-hidden="true"></i><span id="toastMsg"></span></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="loginScreen">
  <div class="login-box" role="region" aria-label="Inicio de sesi√≥n">
    <div class="login-logo" aria-hidden="true"><i class="bi bi-mortarboard-fill"></i></div>
    <div class="login-title">Instituto San Marcos</div>
    <div class="login-sub">Portal Educativo ‚Äî Acceso al Sistema</div>

    <div class="role-cards" role="radiogroup" aria-label="Seleccionar rol">
      <div class="role-card sel" data-role="admin" onclick="selectRole('admin')" role="radio" aria-checked="true" tabindex="0" onkeydown="if(event.key==='Enter'||event.key===' ')selectRole('admin')">
        <i class="ri bi bi-shield-check" style="color:#059669;" aria-hidden="true"></i>
        <span class="rl">Administrador</span>
      </div>
      <div class="role-card" data-role="maestro" onclick="selectRole('maestro')" role="radio" aria-checked="false" tabindex="0" onkeydown="if(event.key==='Enter'||event.key===' ')selectRole('maestro')">
        <i class="ri bi bi-person-badge" style="color:#D97706;" aria-hidden="true"></i>
        <span class="rl">Maestro</span>
      </div>
      <div class="role-card" data-role="alumno" onclick="selectRole('alumno')" role="radio" aria-checked="false" tabindex="0" onkeydown="if(event.key==='Enter'||event.key===' ')selectRole('alumno')">
        <i class="ri bi bi-person-circle" style="color:#4338CA;" aria-hidden="true"></i>
        <span class="rl">Estudiante</span>
      </div>
    </div>

    <div id="loginErr" class="login-err" role="alert"><i class="bi bi-exclamation-triangle-fill me-2" aria-hidden="true"></i><span id="loginErrMsg">Usuario o contrase√±a incorrectos.</span></div>

    <div class="mb-3">
      <label for="loginUser" class="form-label">Usuario</label>
      <input type="text" id="loginUser" class="form-control" placeholder="Ej. admin@isanmarcos.edu" value="admin@isanmarcos.edu" aria-required="true">
    </div>
    <div class="mb-4">
      <label for="loginPass" class="form-label">Contrase√±a</label>
      <div style="position:relative;">
        <input type="password" id="loginPass" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="admin123" style="padding-right:38px;" aria-required="true">
        <button onclick="togglePass()" style="position:absolute;right:9px;top:50%;transform:translateY(-50%);border:none;background:none;color:var(--muted);cursor:pointer;padding:0;font-size:14px;" aria-label="Mostrar u ocultar contrase√±a"><i class="bi bi-eye" id="eyeIcon" aria-hidden="true"></i></button>
      </div>
    </div>
    <button class="btn-login" onclick="doLogin()"><i class="bi bi-box-arrow-in-right me-2" aria-hidden="true"></i>Ingresar al Portal</button>

    <div class="demo-hint">
      <b>Credenciales de prueba:</b><br>
      üü¢ Admin: admin@isanmarcos.edu / admin123<br>
      üü° Maestro: amejia@isanmarcos.edu / maestro123<br>
      üîµ Estudiante: km2024@isanmarcos.edu / alumno123
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PORTAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="portalScreen">
  <div id="sidebarOverlay" onclick="toggleSidebar()" aria-hidden="true"></div>
  <div id="sidebar" role="navigation" aria-label="Men√∫ principal">
    <div class="sidebar-logo">
      <div class="logo-box" aria-hidden="true"><i class="bi bi-mortarboard-fill"></i></div>
      <div><div class="logo-name">Inst. San Marcos</div><div class="logo-sub">Portal Educativo</div></div>
    </div>
    <div class="sidebar-user">
      <div id="sidebarAv" class="user-av uav-admin" aria-hidden="true">DA</div>
      <div><div id="sidebarName" class="user-name">Direcci√≥n Admin.</div><div id="sidebarSub" class="user-sub">Administrador</div></div>
    </div>
    <div id="sidebarNav"></div>
    <div class="sidebar-footer">
      <button class="btn-logout" onclick="doLogout()"><i class="bi bi-box-arrow-left" aria-hidden="true"></i>Cerrar sesi√≥n</button>
    </div>
  </div>

  <div id="mainWrapper" role="main">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:12px;">
        <button class="btn-ico" id="menuToggleBtn" onclick="toggleSidebar()" aria-label="Abrir men√∫"><i class="bi bi-list" aria-hidden="true" style="font-size:18px;"></i></button>
        <span class="topbar-title" id="topbarTitle">Inicio</span>
      </div>
      <div class="topbar-right">
        <div style="position:relative;cursor:pointer;" onclick="goSection('avisos_v')">
          <button class="btn-ico" aria-label="Ver notificaciones"><i class="bi bi-bell" aria-hidden="true"></i></button>
          <span style="position:absolute;top:-3px;right:-3px;background:var(--red);color:#fff;font-size:8px;font-weight:800;border-radius:99px;padding:1px 4px;" aria-label="5 notificaciones no le√≠das">5</span>
        </div>
        <button class="btn-ico" aria-label="Configuraci√≥n"><i class="bi bi-gear" aria-hidden="true"></i></button>
        <div id="topbarAv" class="user-av uav-admin" style="cursor:pointer;" role="button" tabindex="0" aria-label="Perfil de usuario">DA</div>
      </div>
    </div>
    <div id="pageContent"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALES (todos con atributos ARIA) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- Nuevo Alumno -->
<div class="modal fade" id="mNuevoAlumno" tabindex="-1" aria-labelledby="mNuevoAlumnoLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title" id="mNuevoAlumnoLabel"><i class="bi bi-person-plus me-2" aria-hidden="true"></i>Registrar Nuevo Alumno</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button></div>
      <div class="modal-body">
        <div id="mNAAlert" class="modal-alert err" role="alert"><i class="bi bi-exclamation-triangle-fill" aria-hidden="true"></i><span></span></div>
        <div class="row g-3">
          <div class="col-12 col-md-6"><label for="na_nom" class="form-label">Nombre completo *</label><input id="na_nom" class="form-control" placeholder="Mar√≠a L√≥pez Reyes" aria-required="true"><div class="field-err" id="na_nom_e">Este campo es requerido</div></div>
          <div class="col-12 col-md-6"><label for="na_id" class="form-label">No. Identidad *</label><input id="na_id" class="form-control" placeholder="0000-0000-00000" aria-required="true"><div class="field-err" id="na_id_e">Ingresa el n√∫mero de identidad</div></div>
          <div class="col-12 col-md-6"><label for="na_fec" class="form-label">Fecha de nacimiento *</label><input id="na_fec" type="date" class="form-control" aria-required="true"><div class="field-err" id="na_fec_e">Selecciona la fecha</div></div>
          <div class="col-12 col-md-6"><label for="na_sex" class="form-label">Sexo</label><select id="na_sex" class="form-select"><option>Masculino</option><option>Femenino</option></select></div>
          <div class="col-12 col-md-6"><label for="na_grado" class="form-label">Grado *</label><select id="na_grado" class="form-select" aria-required="true"><option>7¬∞ Grado</option><option>8¬∞ Grado</option><option selected>9¬∞ Grado</option><option>10¬∞ Grado</option><option>11¬∞ Grado</option></select></div>
          <div class="col-12 col-md-6"><label for="na_sec" class="form-label">Secci√≥n</label><select id="na_sec" class="form-select"><option>A</option><option selected>B</option><option>C</option></select></div>
          <div class="col-12 col-md-6"><label for="na_tutor" class="form-label">Nombre del tutor *</label><input id="na_tutor" class="form-control" placeholder="Nombre completo del tutor" aria-required="true"><div class="field-err" id="na_tutor_e">Ingresa el nombre del tutor</div></div>
          <div class="col-12 col-md-6"><label for="na_email" class="form-label">Correo del tutor *</label><input id="na_email" type="email" class="form-control" placeholder="tutor@email.com" aria-required="true"><div class="field-err" id="na_email_e">Correo inv√°lido</div></div>
          <div class="col-12 col-md-6"><label for="na_tel" class="form-label">Tel√©fono del tutor</label><input id="na_tel" class="form-control" placeholder="504-9000-0000"></div>
          <div class="col-12 col-md-6"><label for="na_dir" class="form-label">Direcci√≥n</label><input id="na_dir" class="form-control" placeholder="Colonia, ciudad"></div>
        </div>
        <div class="info-box mt-3"><i class="bi bi-info-circle me-1" aria-hidden="true"></i>Se generar√° un c√≥digo de alumno autom√°ticamente. El tutor recibir√° credenciales de acceso por correo.</div>
      </div>
      <div class="modal-footer"><button class="btn-sec" data-bs-dismiss="modal">Cancelar</button><button class="btn-pri" onclick="guardarAlumno()"><i class="bi bi-check2 me-1" aria-hidden="true"></i>Registrar Alumno</button></div>
    </div>
  </div>
</div>

<!-- Nuevo Docente -->
<div class="modal fade" id="mNuevoDocente" tabindex="-1" aria-labelledby="mNuevoDocenteLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title" id="mNuevoDocenteLabel"><i class="bi bi-person-badge me-2" aria-hidden="true"></i>Registrar Docente</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button></div>
      <div class="modal-body">
        <div id="mNDAlert" class="modal-alert err" role="alert"><i class="bi bi-exclamation-triangle-fill" aria-hidden="true"></i><span></span></div>
        <div class="row g-3">
          <div class="col-12 col-md-6"><label for="nd_nom" class="form-label">Nombre completo *</label><input id="nd_nom" class="form-control" aria-required="true"><div class="field-err" id="nd_nom_e">Este campo es requerido</div></div>
          <div class="col-12 col-md-6"><label for="nd_esp" class="form-label">Especialidad *</label><input id="nd_esp" class="form-control" placeholder="Ej. Matem√°ticas" aria-required="true"><div class="field-err" id="nd_esp_e">Ingresa la especialidad</div></div>
          <div class="col-12 col-md-6"><label for="nd_email" class="form-label">Correo institucional *</label><input id="nd_email" type="email" class="form-control" aria-required="true"><div class="field-err" id="nd_email_e">Correo inv√°lido o vac√≠o</div></div>
          <div class="col-12 col-md-6"><label for="nd_tel" class="form-label">Tel√©fono</label><input id="nd_tel" class="form-control" placeholder="504-9000-0000"></div>
          <div class="col-12 col-md-6"><label for="nd_grados" class="form-label">Grados asignados</label><input id="nd_grados" class="form-control" placeholder="Ej. 8¬∞, 9¬∞, 10¬∞"></div>
          <div class="col-12 col-md-6"><label for="nd_est" class="form-label">Estado</label><select id="nd_est" class="form-select"><option>Activo</option><option>Inactivo</option></select></div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn-sec" data-bs-dismiss="modal">Cancelar</button><button class="btn-pri btn-green" onclick="guardarDocente()"><i class="bi bi-check2 me-1" aria-hidden="true"></i>Registrar Docente</button></div>
    </div>
  </div>
</div>

<!-- Registrar Calificaci√≥n -->
<div class="modal fade" id="mCalif" tabindex="-1" aria-labelledby="mCalifLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title" id="mCalifLabel"><i class="bi bi-pencil-square me-2" aria-hidden="true"></i>Registrar Calificaci√≥n</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button></div>
      <div class="modal-body">
        <div id="mCAAlert" class="modal-alert err" role="alert"><i class="bi bi-exclamation-triangle-fill" aria-hidden="true"></i><span></span></div>
        <div class="row g-3">
          <div class="col-12"><label for="rc_alum" class="form-label">Alumno (c√≥digo o nombre) *</label><input id="rc_alum" class="form-control" placeholder="Ej. 2024-0031" aria-required="true"><div class="field-err" id="rc_alum_e">Ingresa el alumno</div></div>
          <div class="col-12 col-md-6"><label for="rc_mat" class="form-label">Materia *</label><select id="rc_mat" class="form-select" aria-required="true"><option value="">‚Äî Selecciona ‚Äî</option><option>Matem√°ticas</option><option>Ciencias Naturales</option><option>Espa√±ol</option><option>Historia</option><option>Ingl√©s</option><option>Educaci√≥n F√≠sica</option><option>Arte y Cultura</option><option>Tecnolog√≠a</option><option>F√≠sica</option></select><div class="field-err" id="rc_mat_e">Selecciona una materia</div></div>
          <div class="col-12 col-md-6"><label for="rc_per" class="form-label">Per√≠odo *</label><select id="rc_per" class="form-select" aria-required="true"><option value="">‚Äî Selecciona ‚Äî</option><option>I Parcial</option><option>II Parcial</option><option>III Parcial</option><option>IV Parcial</option><option>Final</option></select><div class="field-err" id="rc_per_e">Selecciona el per√≠odo</div></div>
          <div class="col-12 col-md-6"><label for="rc_nota" class="form-label">Nota (0-100) *</label><input id="rc_nota" type="number" class="form-control" min="0" max="100" placeholder="87" aria-required="true"><div class="field-err" id="rc_nota_e">Nota entre 0 y 100</div></div>
          <div class="col-12 col-md-6"><label for="rc_doc" class="form-label">Docente</label><input id="rc_doc" class="form-control" value="Prof. Ana Mej√≠a"></div>
          <div class="col-12"><label for="rc_obs" class="form-label">Observaci√≥n</label><textarea id="rc_obs" class="form-control" rows="2" placeholder="Opcional..."></textarea></div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn-sec" data-bs-dismiss="modal">Cancelar</button><button class="btn-pri btn-amber" onclick="guardarCalif()"><i class="bi bi-save me-1" aria-hidden="true"></i>Guardar Nota</button></div>
    </div>
  </div>
</div>

<!-- Publicar Aviso -->
<div class="modal fade" id="mAviso" tabindex="-1" aria-labelledby="mAvisoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title" id="mAvisoLabel"><i class="bi bi-megaphone me-2" aria-hidden="true"></i>Publicar Aviso</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button></div>
      <div class="modal-body">
        <div id="mAVAlert" class="modal-alert err" role="alert"><i class="bi bi-exclamation-triangle-fill" aria-hidden="true"></i><span></span></div>
        <div class="row g-3">
          <div class="col-12"><label for="av_tit" class="form-label">T√≠tulo del aviso *</label><input id="av_tit" class="form-control" placeholder="Ej. Reuni√≥n de Padres de Familia" aria-required="true"><div class="field-err" id="av_tit_e">El t√≠tulo es requerido</div></div>
          <div class="col-12 col-md-6"><label for="av_tipo" class="form-label">Tipo *</label><select id="av_tipo" class="form-select" aria-required="true"><option value="">‚Äî Tipo ‚Äî</option><option>Aviso</option><option>Examen</option><option>Evento</option><option>Importante</option><option>Tarea</option><option>Reuni√≥n</option></select><div class="field-err" id="av_tipo_e">Selecciona el tipo</div></div>
          <div class="col-12 col-md-6"><label for="av_fec" class="form-label">Fecha *</label><input id="av_fec" type="date" class="form-control" aria-required="true"><div class="field-err" id="av_fec_e">Selecciona la fecha</div></div>
          <div class="col-12"><label for="av_dest" class="form-label">Dirigido a</label><select id="av_dest" class="form-select"><option>Todos</option><option>Solo Alumnos</option><option>Solo Docentes</option><option>Padres de Familia</option><option>Grado espec√≠fico</option></select></div>
          <div class="col-12"><label for="av_desc" class="form-label">Descripci√≥n *</label><textarea id="av_desc" class="form-control" rows="3" placeholder="Detalles del aviso..." aria-required="true"></textarea><div class="field-err" id="av_desc_e">Agrega una descripci√≥n</div></div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn-sec" data-bs-dismiss="modal">Cancelar</button><button class="btn-pri" onclick="guardarAviso()"><i class="bi bi-send me-1" aria-hidden="true"></i>Publicar</button></div>
    </div>
  </div>
</div>

<!-- Registrar Asistencia -->
<div class="modal fade" id="mAsistencia" tabindex="-1" aria-labelledby="mAsistenciaLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title" id="mAsistenciaLabel"><i class="bi bi-clipboard-check me-2" aria-hidden="true"></i>Registrar Asistencia</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button></div>
      <div class="modal-body">
        <div id="mASAlert" class="modal-alert err" role="alert"><i class="bi bi-exclamation-triangle-fill" aria-hidden="true"></i><span></span></div>
        <div class="row g-3">
          <div class="col-12"><label for="as_alum" class="form-label">Alumno (c√≥digo) *</label><input id="as_alum" class="form-control" placeholder="2024-0031" aria-required="true"><div class="field-err" id="as_alum_e">Ingresa el c√≥digo del alumno</div></div>
          <div class="col-12 col-md-6"><label for="as_fec" class="form-label">Fecha *</label><input id="as_fec" type="date" class="form-control" aria-required="true"><div class="field-err" id="as_fec_e">Selecciona la fecha</div></div>
          <div class="col-12 col-md-6"><label for="as_est" class="form-label">Estado *</label><select id="as_est" class="form-select" aria-required="true"><option value="">‚Äî Estado ‚Äî</option><option>Presente</option><option>Ausente</option><option>Tardanza</option><option>Justificado</option></select><div class="field-err" id="as_est_e">Selecciona el estado</div></div>
          <div class="col-12"><label for="as_obs" class="form-label">Observaci√≥n</label><input id="as_obs" class="form-control" placeholder="Ej. Present√≥ permiso m√©dico"></div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn-sec" data-bs-dismiss="modal">Cancelar</button><button class="btn-pri btn-teal" onclick="guardarAsistencia()"><i class="bi bi-check2 me-1" aria-hidden="true"></i>Registrar</button></div>
    </div>
  </div>
</div>

<!-- Modal Ver Alumno -->
<div class="modal fade" id="mVerAlumno" tabindex="-1" aria-labelledby="mVerAlumnoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title" id="mVerAlumnoLabel"><i class="bi bi-person me-2" aria-hidden="true"></i>Perfil del Alumno</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button></div>
      <div class="modal-body" id="mVerAlumnoBody"></div>
      <div class="modal-footer"><button class="btn-sec" data-bs-dismiss="modal">Cerrar</button></div>
    </div>
  </div>
</div>

<!-- Tarea Docente -->
<div class="modal fade" id="mTarea" tabindex="-1" aria-labelledby="mTareaLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title" id="mTareaLabel"><i class="bi bi-journal-plus me-2" aria-hidden="true"></i>Asignar Tarea</h5><button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button></div>
      <div class="modal-body">
        <div id="mTAAlert" class="modal-alert err" role="alert"><i class="bi bi-exclamation-triangle-fill" aria-hidden="true"></i><span></span></div>
        <div class="row g-3">
          <div class="col-12"><label for="ta_tit" class="form-label">T√≠tulo de la tarea *</label><input id="ta_tit" class="form-control" placeholder="Ej. Ejercicios cap. 5" aria-required="true"><div class="field-err" id="ta_tit_e">El t√≠tulo es requerido</div></div>
          <div class="col-12 col-md-6"><label for="ta_mat" class="form-label">Materia *</label><select id="ta_mat" class="form-select" aria-required="true"><option value="">‚Äî Selecciona ‚Äî</option><option>Matem√°ticas</option><option>Ciencias Naturales</option><option>Espa√±ol</option><option>Historia</option><option>Ingl√©s</option><option>Arte y Cultura</option><option>Tecnolog√≠a</option></select><div class="field-err" id="ta_mat_e">Selecciona la materia</div></div>
          <div class="col-12 col-md-6"><label for="ta_fec" class="form-label">Fecha l√≠mite *</label><input id="ta_fec" type="date" class="form-control" aria-required="true"><div class="field-err" id="ta_fec_e">Selecciona fecha l√≠mite</div></div>
          <div class="col-12 col-md-6"><label for="ta_grado" class="form-label">Grado</label><select id="ta_grado" class="form-select"><option>9¬∞ Grado A</option><option selected>9¬∞ Grado B</option><option>9¬∞ Grado C</option><option>Todos 9¬∞</option></select></div>
          <div class="col-12 col-md-6"><label for="ta_pts" class="form-label">Puntos</label><input id="ta_pts" type="number" class="form-control" value="10" min="1" max="100"></div>
          <div class="col-12"><label for="ta_desc" class="form-label">Descripci√≥n *</label><textarea id="ta_desc" class="form-control" rows="3" placeholder="Instrucciones de la tarea..." aria-required="true"></textarea><div class="field-err" id="ta_desc_e">Agrega las instrucciones</div></div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn-sec" data-bs-dismiss="modal">Cancelar</button><button class="btn-pri btn-amber" onclick="guardarTarea()"><i class="bi bi-send me-1" aria-hidden="true"></i>Asignar Tarea</button></div>
    </div>
  </div>
</div>

<!-- Bootstrap -->
<!-- ‚ïê‚ïê BOTTOM NAV M√ìVIL ‚ïê‚ïê -->
<div id="bottomNav" role="navigation" aria-label="Navegaci√≥n principal m√≥vil">
  <div class="bn-items" id="bnItems"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DATA PERSISTENTE (simula base de datos)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const USERS = {
  'admin@isanmarcos.edu':   { pass:'admin123',   role:'admin',   nombre:'Direcci√≥n Acad√©mica', sub:'Administrador del Sistema', av:'DA', avcls:'uav-admin' },
  'amejia@isanmarcos.edu':  { pass:'maestro123', role:'maestro', nombre:'Prof. Ana Mej√≠a',      sub:'Docente ¬∑ Matem√°ticas',      av:'AM', avcls:'uav-maestro' },
  'km2024@isanmarcos.edu':  { pass:'alumno123',  role:'alumno',  nombre:'Kevin Mart√≠nez',        sub:'Estudiante ¬∑ 9¬∞ Grado "B"',   av:'KM', avcls:'uav-alumno' },
};

let currentUser = null;
let selectedRole = 'admin';

// Datos iniciales - ser√°n modificables en tiempo de ejecuci√≥n
let DB = {
  alumnos: JSON.parse(localStorage.getItem('db_alumnos')) || [
    {codigo:'2024-0031',nombre:'Kevin Mart√≠nez',   grado:'9¬∞ B',promedio:88,asistencia:94,estado:'Activo',tutor:'Roberto Mart√≠nez'},
    {codigo:'2024-0032',nombre:'Sof√≠a Hern√°ndez',  grado:'9¬∞ B',promedio:93,asistencia:98,estado:'Activo',tutor:'Carmen Hern√°ndez'},
    {codigo:'2024-0033',nombre:'Diego Fuentes',    grado:'9¬∞ A',promedio:76,asistencia:88,estado:'Activo',tutor:'Luis Fuentes'},
    {codigo:'2024-0034',nombre:'Mariana L√≥pez',    grado:'8¬∞ C',promedio:91,asistencia:96,estado:'Activo',tutor:'Gloria L√≥pez'},
    {codigo:'2024-0035',nombre:'Carlos Reyes',     grado:'10¬∞ B',promedio:62,asistencia:72,estado:'En riesgo',tutor:'Pedro Reyes'},
    {codigo:'2024-0036',nombre:'Valentina Cruz',   grado:'7¬∞ A',promedio:87,asistencia:91,estado:'Activo',tutor:'Irene Cruz'},
    {codigo:'2024-0037',nombre:'Andr√©s Medina',    grado:'11¬∞ B',promedio:95,asistencia:99,estado:'Activo',tutor:'Jorge Medina'},
    {codigo:'2024-0038',nombre:'Laura Jim√©nez',    grado:'8¬∞ A',promedio:72,asistencia:85,estado:'Activo',tutor:'Rosa Jim√©nez'},
  ],
  docentes: JSON.parse(localStorage.getItem('db_docentes')) || [
    {nombre:'Ana Mej√≠a',    esp:'Matem√°ticas',       grados:'7¬∞,8¬∞,9¬∞',      email:'amejia@isanmarcos.edu', tel:'504-9100-0001',estado:'Activo',ingreso:'15/03/2015'},
    {nombre:'Jos√© Ruiz',    esp:'Ciencias Naturales', grados:'8¬∞,9¬∞,10¬∞',     email:'jruiz@isanmarcos.edu',  tel:'504-9100-0002',estado:'Activo',ingreso:'01/08/2017'},
    {nombre:'Luc√≠a Torres', esp:'Espa√±ol',            grados:'7¬∞,8¬∞,9¬∞',      email:'ltorres@isanmarcos.edu',tel:'504-9100-0003',estado:'Activo',ingreso:'10/02/2018'},
    {nombre:'Miguel Soto',  esp:'Historia',           grados:'9¬∞,10¬∞,11¬∞',    email:'msoto@isanmarcos.edu',  tel:'504-9100-0004',estado:'Activo',ingreso:'05/06/2016'},
    {nombre:'Sandra Paz',   esp:'Ingl√©s',             grados:'7¬∞,8¬∞,9¬∞,10¬∞',  email:'spaz@isanmarcos.edu',   tel:'504-9100-0005',estado:'Activo',ingreso:'20/01/2019'},
    {nombre:'Roberto Leiva',esp:'Ed. F√≠sica',         grados:'Todos',          email:'rleiva@isanmarcos.edu', tel:'504-9100-0006',estado:'Activo',ingreso:'12/09/2014'},
  ],
  materias: JSON.parse(localStorage.getItem('db_materias')) || [
    {nombre:'Matem√°ticas',       docente:'Prof. Ana Mej√≠a',    nota:92,progreso:92},
    {nombre:'Ciencias Naturales',docente:'Prof. Jos√© Ruiz',    nota:85,progreso:85},
    {nombre:'Espa√±ol',           docente:'Prof. Luc√≠a Torres', nota:88,progreso:88},
    {nombre:'Historia',          docente:'Prof. Miguel Soto',  nota:79,progreso:79},
    {nombre:'Ingl√©s',            docente:'Prof. Sandra Paz',   nota:91,progreso:91},
    {nombre:'Educaci√≥n F√≠sica',  docente:'Prof. Roberto Leiva',nota:95,progreso:95},
    {nombre:'Arte y Cultura',    docente:'Prof. Elena Vega',   nota:83,progreso:83},
  ],
  avisos: JSON.parse(localStorage.getItem('db_avisos')) || [
    {titulo:'Examen de Matem√°ticas ‚Äì √Ålgebra',   fecha:'03/03/2026',tipo:'Examen',   color:'#DC2626',desc:'Cap√≠tulos 5, 6 y 7. Se permite calculadora.'},
    {titulo:'Entrega de proyecto de Ciencias',   fecha:'28/02/2026',tipo:'Tarea',    color:'#D97706',desc:'Proyecto sobre ecosistemas locales.'},
    {titulo:'D√≠a libre por reuni√≥n de docentes', fecha:'05/03/2026',tipo:'Aviso',    color:'#4338CA',desc:'No habr√° clases ese d√≠a.'},
    {titulo:'Inicio de III Parcial',             fecha:'01/03/2026',tipo:'Importante',color:'#059669',desc:'Per√≠odo de evaluaciones del tercer parcial.'},
    {titulo:'Festival Cultural Escolar 2026',    fecha:'15/03/2026',tipo:'Evento',   color:'#7C3AED',desc:'Participaci√≥n de todos los grados.'},
  ],
  asistencia: JSON.parse(localStorage.getItem('db_asistencia')) || [
    {fecha:'26/02/2026',dia:'Jueves',   estado:'Presente', obs:''},
    {fecha:'25/02/2026',dia:'Mi√©rcoles',estado:'Presente', obs:''},
    {fecha:'24/02/2026',dia:'Martes',   estado:'Ausente',  obs:'Sin justificaci√≥n'},
    {fecha:'21/02/2026',dia:'Viernes',  estado:'Presente', obs:''},
    {fecha:'20/02/2026',dia:'Jueves',   estado:'Presente', obs:''},
    {fecha:'19/02/2026',dia:'Mi√©rcoles',estado:'Tardanza', obs:'Lleg√≥ 10 min tarde'},
    {fecha:'18/02/2026',dia:'Martes',   estado:'Presente', obs:''},
    {fecha:'17/02/2026',dia:'Lunes',    estado:'Presente', obs:''},
  ],
  tareas: JSON.parse(localStorage.getItem('db_tareas')) || [
    {titulo:'Ejercicios √°lgebra cap. 5',    materia:'Matem√°ticas', fechaIni:'01/02/2026',      fecha:'03/03/2026',estado:'Pendiente',pts:10,grado:'9¬∞ B'},
    {titulo:'Lectura "Cien a√±os de soledad"',materia:'Espa√±ol',   fechaIni:'02/03/2026',       fecha:'05/03/2026',estado:'Pendiente',pts:15,grado:'9¬∞ B'},
    {titulo:'Mapa ecosistemas Honduras',    materia:'Ciencias Naturales', fechaIni:'03/04/2026', fecha:'28/02/2026',estado:'Entregado', pts:20,grado:'9¬∞ B'},
    {titulo:'L√≠nea de tiempo Guerra Fr√≠a',  materia:'Historia',  fechaIni:'04/05/2026',        fecha:'07/03/2026',estado:'Pendiente',pts:10,grado:'9¬∞ B'},
    {titulo:'Essay "My School"',            materia:'Ingl√©s',  fechaIni:'05/06/2026',          fecha:'04/03/2026',estado:'Pendiente',pts:10,grado:'9¬∞ B'},
  ],
  pagos: JSON.parse(localStorage.getItem('db_pagos')) || [
    {ref:'PAG-0041',alumno:'Kevin Mart√≠nez',   concepto:'Mensualidad Febrero',monto:800,fecha:'05/02/2026',estado:'Pagado'},
    {ref:'PAG-0040',alumno:'Sof√≠a Hern√°ndez',  concepto:'Mensualidad Febrero',monto:800,fecha:'04/02/2026',estado:'Pagado'},
    {ref:'PAG-0039',alumno:'Carlos Reyes',     concepto:'Mensualidad Enero',  monto:800,fecha:'20/01/2026',estado:'Pendiente'},
    {ref:'PAG-0038',alumno:'Diego Fuentes',    concepto:'Mensualidad Febrero',monto:800,fecha:'06/02/2026',estado:'Pagado'},
    {ref:'PAG-0037',alumno:'Mariana L√≥pez',    concepto:'Material extra',     monto:250,fecha:'15/01/2026',estado:'Pagado'},
    {ref:'PAG-0036',alumno:'Valentina Cruz',   concepto:'Mensualidad Febrero',monto:800,fecha:'03/02/2026',estado:'Pagado'},
  ],
  misTareas: JSON.parse(localStorage.getItem('db_misTareas')) || [ // Docente
    {titulo:'Ejercicios √°lgebra cap. 5',  materia:'Matem√°ticas', fechaIni:'01/02/2026', fecha:'03/03/2026',fecha:'03/03/2026',grado:'9¬∞ B',entregadas:18,total:25,pts:10},
    {titulo:'Examen Parcial III',         materia:'Matem√°ticas',fechaIni:'01/02/2026', fecha:'07/03/2026',grado:'9¬∞ A',entregadas:0, total:22,pts:50},
    {titulo:'Taller de gr√°ficas',         materia:'Matem√°ticas',fechaIni:'01/02/2026', fecha:'28/02/2026',grado:'8¬∞ C',entregadas:21,total:21,pts:15},
  ],
  misAlumnos: JSON.parse(localStorage.getItem('db_misAlumnos')) || [ // Docente
    {codigo:'2024-0031',nombre:'Kevin Mart√≠nez', grado:'9¬∞ B',ultima:92,asistencia:94,estado:'Activo'},
    {codigo:'2024-0032',nombre:'Sof√≠a Hern√°ndez',grado:'9¬∞ B',ultima:98,asistencia:98,estado:'Activo'},
    {codigo:'2024-0033',nombre:'Diego Fuentes',  grado:'9¬∞ A',ultima:76,asistencia:88,estado:'Activo'},
    {codigo:'2024-0034',nombre:'Mariana L√≥pez',  grado:'8¬∞ C',ultima:91,asistencia:96,estado:'Activo'},
    {codigo:'2024-0035',nombre:'Carlos Reyes',   grado:'10¬∞ B',ultima:62,asistencia:72,estado:'En riesgo'},
  ],
};

// Funci√≥n para guardar en localStorage (persistencia simulada)
function saveToStorage() {
  localStorage.setItem('db_alumnos', JSON.stringify(DB.alumnos));
  localStorage.setItem('db_docentes', JSON.stringify(DB.docentes));
  localStorage.setItem('db_materias', JSON.stringify(DB.materias));
  localStorage.setItem('db_avisos', JSON.stringify(DB.avisos));
  localStorage.setItem('db_asistencia', JSON.stringify(DB.asistencia));
  localStorage.setItem('db_tareas', JSON.stringify(DB.tareas));
  localStorage.setItem('db_pagos', JSON.stringify(DB.pagos));
  localStorage.setItem('db_misTareas', JSON.stringify(DB.misTareas));
  localStorage.setItem('db_misAlumnos', JSON.stringify(DB.misAlumnos));
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODALS INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const modals = {};
['mNuevoAlumno','mNuevoDocente','mCalif','mAviso','mAsistencia','mVerAlumno','mTarea'].forEach(id=>{
  modals[id] = new bootstrap.Modal(document.getElementById(id));
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOAST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let toastTimer;
function toast(msg, type='ok') {
  const el = document.getElementById('toast');
  const icons = {ok:'bi-check-circle-fill', err:'bi-x-circle-fill', warn:'bi-exclamation-triangle-fill'};
  el.className = `show t-${type}`;
  document.getElementById('toastIcon').className = `bi ${icons[type]||icons.ok}`;
  document.getElementById('toastMsg').textContent = msg;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>{ el.className = `t-${type}`; }, 3500);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODAL INLINE ERRORS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function clearModalErrors(alertId, fields) {
  const a = document.getElementById(alertId);
  if(a){ a.classList.remove('show'); }
  fields.forEach(f => {
    const el = document.getElementById(f);
    const er = document.getElementById(f+'_e');
    if(el){ el.classList.remove('is-invalid'); }
    if(er){ er.classList.remove('show'); }
  });
}

function showModalAlert(alertId, msg) {
  const a = document.getElementById(alertId);
  if(!a) return;
  a.classList.add('show');
  a.querySelector('span').textContent = msg;
}

function fieldErr(fieldId) {
  const el = document.getElementById(fieldId);
  const er = document.getElementById(fieldId+'_e');
  if(el) el.classList.add('is-invalid');
  if(er) er.classList.add('show');
}

function validateRequired(pairs, alertId) {
  // pairs = [[fieldId, 'label'], ...]
  let firstErr = null;
  let hasErr = false;
  pairs.forEach(([fid, label]) => {
    const el = document.getElementById(fid);
    if(!el) return;
    const val = el.value.trim();
    const isEmpty = !val || val === '';
    if(isEmpty) {
      fieldErr(fid);
      if(!firstErr) firstErr = label;
      hasErr = true;
    }
  });
  if(hasErr) {
    showModalAlert(alertId, `Por favor completa: ${firstErr}. Los campos marcados con * son requeridos.`);
    return false;
  }
  return true;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LOGIN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function selectRole(role) {
  selectedRole = role;
  document.querySelectorAll('.role-card').forEach(c => c.classList.remove('sel'));
  document.querySelector(`[data-role="${role}"]`).classList.add('sel');
  const demos = {
    admin:   {user:'admin@isanmarcos.edu',   pass:'admin123'},
    maestro: {user:'amejia@isanmarcos.edu',  pass:'maestro123'},
    alumno:  {user:'km2024@isanmarcos.edu',  pass:'alumno123'},
  };
  document.getElementById('loginUser').value = demos[role].user;
  document.getElementById('loginPass').value = demos[role].pass;
  document.getElementById('loginErr').style.display = 'none';
}

function togglePass() {
  const p = document.getElementById('loginPass');
  const e = document.getElementById('eyeIcon');
  if(p.type === 'password') { p.type='text'; e.className='bi bi-eye-slash'; }
  else { p.type='password'; e.className='bi bi-eye'; }
}

function doLogin() {
  const user = document.getElementById('loginUser').value.trim();
  const pass = document.getElementById('loginPass').value.trim();
  const errEl = document.getElementById('loginErr');

  if(!user || !pass) {
    errEl.style.display = 'flex';
    document.getElementById('loginErrMsg').textContent = 'Por favor ingresa usuario y contrase√±a.';
    return;
  }

  const u = USERS[user];
  if(!u || u.pass !== pass) {
    errEl.style.display = 'flex';
    document.getElementById('loginErrMsg').textContent = 'Usuario o contrase√±a incorrectos. Verifica tus datos.';
    return;
  }

  errEl.style.display = 'none';
  currentUser = { ...u, email: user };
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('portalScreen').style.display = 'block';
  initPortal();
}

document.getElementById('loginPass').addEventListener('keypress', e => { if(e.key==='Enter') doLogin(); });

function doLogout() {
  currentUser = null;
  document.getElementById('portalScreen').style.display = 'none';
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('loginErr').style.display = 'none';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PORTAL INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function initPortal() {
  const u = currentUser;
  document.getElementById('sidebarAv').className   = `user-av ${u.avcls}`;
  document.getElementById('sidebarAv').textContent  = u.av;
  document.getElementById('sidebarName').textContent = u.nombre;
  document.getElementById('sidebarSub').textContent  = u.sub;
  document.getElementById('topbarAv').className    = `user-av ${u.avcls}`;
  document.getElementById('topbarAv').textContent   = u.av;

  const navs = { admin: NAV_ADMIN, maestro: NAV_MAESTRO, alumno: NAV_ALUMNO };
  buildNav(navs[u.role]);

  const starts = { admin:'adm_inicio', maestro:'mae_inicio', alumno:'alu_inicio' };
  goSection(starts[u.role]);
  buildBottomNav(u.role);
}

function buildBottomNav(role) {
  const shortcuts = {
    admin:   [{id:'adm_inicio',icon:'bi-grid-fill',txt:'Inicio'},{id:'adm_alumnos',icon:'bi-people-fill',txt:'Alumnos'},{id:'adm_avisos',icon:'bi-megaphone-fill',txt:'Avisos'},{id:'adm_pagos',icon:'bi-cash-stack',txt:'Pagos'},{id:'adm_config',icon:'bi-gear-fill',txt:'Config'}],
    maestro: [{id:'mae_inicio',icon:'bi-grid-fill',txt:'Panel'},{id:'mae_misalumnos',icon:'bi-people-fill',txt:'Alumnos'},{id:'mae_avisos',icon:'bi-bell-fill',txt:'Avisos'},{id:'mae_tareas',icon:'bi-journal-plus',txt:'Tareas'},{id:'mae_calific',icon:'bi-pencil-square',txt:'Notas'}],
    alumno:  [{id:'alu_inicio',icon:'bi-house-fill',txt:'Inicio'},{id:'alu_calific',icon:'bi-award-fill',txt:'Notas'},{id:'alu_horario',icon:'bi-calendar3',txt:'Horario'},{id:'alu_tareas',icon:'bi-journal-text',txt:'Tareas'},{id:'alu_avisos',icon:'bi-bell-fill',txt:'Avisos'}],
  };
  const items = shortcuts[role] || [];
  const el = document.getElementById('bnItems');
  if(!el) return;
  el.innerHTML = items.map(it =>
    `<button class="bn-item" id="bn_${it.id}" onclick="goSection('${it.id}')" aria-label="${it.txt}">
      <i class="bi ${it.icon}"></i><span>${it.txt}</span>
    </button>`
  ).join('');
}

function updateBottomNav(id) {
  document.querySelectorAll('.bn-item').forEach(b => b.classList.remove('active','amber'));
  const el = document.getElementById('bn_'+id);
  if(el) {
    el.classList.add('active');
    if(currentUser?.role==='maestro') el.classList.add('amber');
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NAV
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const NAV_ADMIN = [
  { label:'Panel', items:[
    {id:'adm_inicio',   icon:'bi-grid-fill',         txt:'Dashboard'},
    {id:'adm_avisos',   icon:'bi-megaphone-fill',     txt:'Comunicados', badge:'5'},
  ]},
  { label:'Gesti√≥n Acad√©mica', items:[
    {id:'adm_alumnos',  icon:'bi-people-fill',        txt:'Alumnos', badge:''+DB.alumnos.length},
    {id:'adm_docentes', icon:'bi-person-badge-fill',  txt:'Docentes'},
    {id:'adm_calific',  icon:'bi-pencil-square',      txt:'Calificaciones'},
    {id:'adm_asist',    icon:'bi-clipboard-check-fill',txt:'Asistencia'},
    {id:'adm_horario',  icon:'bi-calendar3',          txt:'Horarios'},
    {id:'adm_tareas',   icon:'bi-journal-text',       txt:'Tareas y Actividades'},
  ]},
  { label:'Administraci√≥n', items:[
    {id:'adm_pagos',    icon:'bi-cash-stack',         txt:'Pagos y Finanzas'},
    {id:'adm_reportes', icon:'bi-bar-chart-fill',     txt:'Reportes'},
    {id:'adm_config',   icon:'bi-gear-fill',          txt:'Configuraci√≥n'},
  ]},
];

const NAV_MAESTRO = [
  { label:'Panel', items:[
    {id:'mae_inicio',   icon:'bi-grid-fill',          txt:'Mi Panel'},
    {id:'mae_avisos',   icon:'bi-bell-fill',          txt:'Avisos', badge:'5'},
  ]},
  { label:'Mis Clases', items:[
    {id:'mae_misalumnos',icon:'bi-people-fill',        txt:'Mis Alumnos'},
    {id:'mae_calific',  icon:'bi-pencil-square',       txt:'Calificaciones'},
    {id:'mae_asist',    icon:'bi-clipboard-check-fill',txt:'Pasar Asistencia'},
    {id:'mae_tareas',   icon:'bi-journal-plus',        txt:'Tareas y Ex√°menes'},
    {id:'mae_horario',  icon:'bi-calendar3',           txt:'Mi Horario'},
  ]},
  { label:'Comunicaci√≥n', items:[
    {id:'mae_mensajes', icon:'bi-chat-dots-fill',      txt:'Mensajes', badge:'3'},
    {id:'mae_reportes', icon:'bi-bar-chart-fill',      txt:'Reportes de Clase'},
  ]},
];

const NAV_ALUMNO = [
  { label:'Mi Portal', items:[
    {id:'alu_inicio',   icon:'bi-house-fill',          txt:'Inicio'},
    {id:'alu_avisos',   icon:'bi-bell-fill',           txt:'Avisos', badge:'5'},
  ]},
  { label:'Acad√©mico', items:[
    {id:'alu_calific',  icon:'bi-award-fill',          txt:'Mis Calificaciones'},
    {id:'alu_horario',  icon:'bi-calendar3',           txt:'Mi Horario'},
    {id:'alu_asist',    icon:'bi-check2-square',       txt:'Mi Asistencia'},
    {id:'alu_tareas',   icon:'bi-journal-text',        txt:'Tareas y Actividades'},
    {id:'alu_docentes', icon:'bi-person-badge',        txt:'Mis Docentes'},
  ]},
  { label:'Personal', items:[
    {id:'alu_pagos',    icon:'bi-receipt',             txt:'Estado de Cuenta'},
    {id:'alu_mensajes', icon:'bi-chat-dots-fill',      txt:'Mensajes', badge:'1'},
    {id:'alu_perfil',   icon:'bi-person-circle',       txt:'Mi Perfil'},
  ]},
];

function buildNav(nav) {
  const el = document.getElementById('sidebarNav');
  el.innerHTML = '';
  nav.forEach(grp => {
    const lbl = document.createElement('div');
    lbl.className = 'nav-label';
    lbl.textContent = grp.label;
    el.appendChild(lbl);
    grp.items.forEach(item => {
      const btn = document.createElement('button');
      btn.className = 'nav-item';
      btn.id = 'nav_'+item.id;
      btn.onclick = () => goSection(item.id);
      btn.innerHTML = `<i class="ni bi ${item.icon}"></i><span style="flex:1;">${item.txt}</span>${item.badge?`<span class="nav-badge">${item.badge}</span>`:''}`;
      el.appendChild(btn);
    });
  });
}

function setActiveNav(id) {
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active','green','amber'));
  const el = document.getElementById('nav_'+id);
  if(el) {
    const cls = currentUser?.role==='maestro'?'amber':currentUser?.role==='alumno'?'':'' ;
    el.classList.add('active');
    if(cls) el.classList.add(cls);
  }
  if(typeof updateBottomNav === 'function') updateBottomNav(id);
}

const TITLES = {
  adm_inicio:'Dashboard', adm_avisos:'Comunicados', adm_alumnos:'Alumnos', adm_docentes:'Docentes',
  adm_calific:'Calificaciones', adm_asist:'Asistencia', adm_horario:'Horarios', adm_tareas:'Tareas y Actividades',
  adm_pagos:'Pagos y Finanzas', adm_reportes:'Reportes', adm_config:'Configuraci√≥n',
  mae_inicio:'Mi Panel', mae_avisos:'Avisos', mae_misalumnos:'Mis Alumnos',
  mae_calific:'Calificaciones', mae_asist:'Pasar Asistencia', mae_tareas:'Tareas y Ex√°menes',
  mae_horario:'Mi Horario', mae_mensajes:'Mensajes', mae_reportes:'Reportes de Clase',
  alu_inicio:'Inicio', alu_avisos:'Avisos y Eventos', alu_calific:'Mis Calificaciones',
  alu_horario:'Mi Horario', alu_asist:'Mi Asistencia', alu_tareas:'Tareas y Actividades',
  alu_docentes:'Mis Docentes', alu_pagos:'Estado de Cuenta', alu_mensajes:'Mensajes', alu_perfil:'Mi Perfil',
  avisos_v:'Avisos',
};

function goSection(id) {
  setActiveNav(id);
  document.getElementById('topbarTitle').textContent = TITLES[id] || id;
  if(window.innerWidth < 768) toggleSidebar(true);
  const map = {
    adm_inicio: renderAdmInicio, adm_avisos: renderAvisosMgr, adm_alumnos: renderAdmAlumnos,
    adm_docentes: renderAdmDocentes, adm_calific: renderAdmCalif, adm_asist: renderAdmAsist,
    adm_horario: renderHorario, adm_tareas: renderAdmTareas, adm_pagos: renderAdmPagos,
    adm_reportes: renderAdmReportes, adm_config: renderConfig,
    mae_inicio: renderMaeInicio, mae_avisos: renderAvisosView, mae_misalumnos: renderMaeAlumnos,
    mae_calific: renderMaeCalif, mae_asist: renderMaeAsist, mae_tareas: renderMaeTareas,
    mae_horario: renderHorario, mae_mensajes: renderMensajes, mae_reportes: renderMaeReportes,
    alu_inicio: renderAluInicio, alu_avisos: renderAvisosView, alu_calific: renderAluCalif,
    alu_horario: renderHorario, alu_asist: renderAluAsist, alu_tareas: renderAluTareas,
    alu_docentes: renderAluDocentes, alu_pagos: renderAluPagos, alu_mensajes: renderMensajes,
    alu_perfil: renderAluPerfil, avisos_v: renderAvisosView,
  };
  const fn = map[id];
  if(fn) fn();
  else document.getElementById('pageContent').innerHTML = `<div class="text-center p-5 text-muted"><i class="bi bi-tools" style="font-size:32px;"></i><br><br>Esta secci√≥n est√° en desarrollo</div>`;
  setTimeout(() => {
    document.querySelectorAll('#pageContent table.tbl').forEach(t => {
      if(!t.parentElement.classList.contains('tbl-wrap') && t.parentElement.style.overflowX !== 'auto'){
        const wrap = document.createElement('div');
        wrap.className = 'tbl-wrap';
        t.parentNode.insertBefore(wrap, t);
        wrap.appendChild(t);
      }
    });
  }, 50);
}

function toggleSidebar(forceClose) {
  const sb = document.getElementById('sidebar');
  const ov = document.getElementById('sidebarOverlay');
  if(forceClose || sb.classList.contains('open')){
    sb.classList.remove('open');
    ov.classList.remove('show');
  } else {
    sb.classList.add('open');
    ov.classList.add('show');
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HELPERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const noteBg  = n => n>=90?'cal-a':n>=70?'cal-b':n>=60?'cal-c':'cal-d';
const noteCol = n => n>=90?'var(--green)':n>=70?'var(--indigo)':n>=60?'var(--amber)':'var(--red)';
const asistBd = s => s==='Presente'?'bd-green':s==='Ausente'?'bd-red':s==='Tardanza'?'bd-amber':'bd-teal';
const colorAviso = {Examen:'#DC2626',Tarea:'#D97706',Aviso:'#4338CA',Importante:'#059669',Evento:'#7C3AED',Reuni√≥n:'#0891B2'};

function avatarBox(nombre, cls, size=40) {
  const ini = nombre.split(' ').map(w=>w[0]).slice(0,2).join('');
  return `<div style="width:${size}px;height:${size}px;border-radius:50%;background:linear-gradient(135deg,var(--indigo),var(--violet));color:#fff;font-size:${size*0.3}px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;">${ini}</div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FUNCIONES DE EDICI√ìN Y ELIMINACI√ìN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function editarAlumno(codigo) {
  const alumno = DB.alumnos.find(a => a.codigo === codigo);
  if (!alumno) return;
  
  // Rellenar formulario (simulado - en producci√≥n ser√≠a un modal de edici√≥n)
  toast(`Editando alumno: ${alumno.nombre}`, 'warn');
  // Aqu√≠ ir√≠a la l√≥gica para abrir modal de edici√≥n con datos precargados
}

function eliminarAlumno(codigo) {
  if (!confirm('¬øEst√°s seguro de eliminar este alumno? Esta acci√≥n no se puede deshacer.')) return;
  
  const index = DB.alumnos.findIndex(a => a.codigo === codigo);
  if (index !== -1) {
    DB.alumnos.splice(index, 1);
    saveToStorage();
    toast('Alumno eliminado correctamente', 'err');
    if (document.getElementById('tbAlum')) renderAdmAlumnos(); // Recargar vista si est√° visible
  }
}

function editarDocente(email) {
  const docente = DB.docentes.find(d => d.email === email);
  if (!docente) return;
  toast(`Editando docente: ${docente.nombre}`, 'warn');
}

function eliminarDocente(email) {
  if (!confirm('¬øEst√°s seguro de eliminar este docente?')) return;
  const index = DB.docentes.findIndex(d => d.email === email);
  if (index !== -1) {
    DB.docentes.splice(index, 1);
    saveToStorage();
    toast('Docente eliminado correctamente', 'err');
    if (currentUser?.role === 'admin') renderAdmDocentes();
  }
}

function editarAviso(titulo) {
  toast(`Editando aviso: ${titulo}`, 'warn');
}

function eliminarAviso(titulo) {
  if (!confirm('¬øEliminar este aviso?')) return;
  const index = DB.avisos.findIndex(a => a.titulo === titulo);
  if (index !== -1) {
    DB.avisos.splice(index, 1);
    saveToStorage();
    toast('Aviso eliminado', 'err');
    if (currentUser?.role === 'admin') renderAvisosMgr();
    else renderAvisosView();
  }
}

function editarTarea(titulo) {
  toast(`Editando tarea: ${titulo}`, 'warn');
}

function eliminarTarea(titulo) {
  if (!confirm('¬øEliminar esta tarea?')) return;
  const index = DB.tareas.findIndex(t => t.titulo === titulo);
  if (index !== -1) {
    DB.tareas.splice(index, 1);
    saveToStorage();
    toast('Tarea eliminada', 'err');
    if (currentUser?.role === 'admin') renderAdmTareas();
    else if (currentUser?.role === 'maestro') renderMaeTareas();
    else renderAluTareas();
  }
}

function editarPago(ref) {
  toast(`Editando pago: ${ref}`, 'warn');
}

function eliminarPago(ref) {
  if (!confirm('¬øEliminar este registro de pago?')) return;
  const index = DB.pagos.findIndex(p => p.ref === ref);
  if (index !== -1) {
    DB.pagos.splice(index, 1);
    saveToStorage();
    toast('Pago eliminado', 'err');
    if (currentUser?.role === 'admin') renderAdmPagos();
    else renderAluPagos();
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  ALUMNO VIEWS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderAluInicio() {
  const a = DB.alumnos[0];
  const promedio = (DB.materias.reduce((s,m)=>s+m.nota,0)/DB.materias.length).toFixed(1);
  document.getElementById('pageContent').innerHTML = `
<div class="row g-3 mb-4">
  <div class="col-12 col-lg-8">
    <div class="acct-hero" style="background:linear-gradient(135deg,#312E81,#4338CA,#7C3AED);">
      <div class="hero-type">Bienvenido al Portal Estudiantil</div>
      <div class="hero-num">${a.codigo} ¬∑ ${a.grado}</div>
      <div class="hero-name">${a.nombre}</div>
      <div class="hero-meta">
        <div class="hero-kv"><span class="hero-k">Promedio</span><span class="hero-v">${promedio}</span></div>
        <div style="border-left:1px solid rgba(255,255,255,.2);"></div>
        <div class="hero-kv"><span class="hero-k">Asistencia</span><span class="hero-v">${a.asistencia}%</span></div>
        <div style="border-left:1px solid rgba(255,255,255,.2);"></div>
        <div class="hero-kv"><span class="hero-k">Tutor</span><span class="hero-v" style="font-size:13px;margin-top:2px;">${a.tutor}</span></div>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-4">
    <div class="row g-3 h-100">
      <div class="col-6 col-lg-12"><div class="stat-card"><div class="stat-top" style="background:var(--amber);"></div><div class="stat-val">${DB.tareas.filter(t=>t.estado==='Pendiente').length}</div><div class="stat-label">Tareas Pendientes</div><div class="stat-sub text-muted">Pr√≥xima: ${DB.tareas.find(t=>t.estado==='Pendiente')?.fecha||'-'}</div></div></div>
      <div class="col-6 col-lg-12"><div class="stat-card"><div class="stat-top" style="background:var(--red);"></div><div class="stat-val">${DB.avisos.length}</div><div class="stat-label">Avisos Nuevos</div><div class="stat-sub"><button class="btn-pri btn-sm" onclick="goSection('alu_avisos')">Ver avisos</button></div></div></div>
    </div>
  </div>
</div>

<div class="row g-4">
  <div class="col-12 col-md-7">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-award me-2 text-primary"></i>Calificaciones por Materia</span><button class="btn-sec btn-sm" onclick="goSection('alu_calific')">Ver todo</button></div>
      ${DB.materias.map(m=>`
      <div class="tx-row">
        <div class="cal-box ${noteBg(m.nota)}">${m.nota}</div>
        <div style="flex:1;min-width:0;">
          <div style="font-size:13px;font-weight:700;">${m.nombre}</div>
          <div style="font-size:11px;color:var(--muted);">${m.docente}</div>
          <div class="prog-wrap mt-1"><div class="prog-bar" style="width:${m.nota}%;background:${noteCol(m.nota)};"></div></div>
        </div>
        <span class="bd ${m.nota>=70?'bd-green':'bd-red'} ms-2">${m.nota>=70?'Aprobado':'Reprobado'}</span>
      </div>`).join('')}
    </div>
  </div>
  <div class="col-12 col-md-5 d-flex flex-column gap-3">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-journal-text me-2 text-warning"></i>Tareas Pendientes</span><button class="btn-sec btn-sm" onclick="goSection('alu_tareas')">Ver todo</button></div>
      ${DB.tareas.filter(t=>t.estado==='Pendiente').map(t=>`
      <div class="tx-row">
        <div class="tx-ico" style="background:#FEF3C7;"><i class="bi bi-journal text-warning"></i></div>
        <div style="flex:1;"><div style="font-size:13px;font-weight:700;">${t.titulo}</div><div style="font-size:11px;color:var(--muted);">${t.materia} ¬∑ Entrega: ${t.fecha}</div></div>
        <span class="bd bd-amber">${t.pts} pts</span>
      </div>`).join('')}
    </div>
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-bell me-2 text-danger"></i>Avisos</span></div>
      ${DB.avisos.slice(0,3).map(av=>`
      <div class="notice-item">
        <div class="notice-dot" style="background:${av.color};"></div>
        <div><div style="font-size:12px;font-weight:700;">${av.titulo}</div><div style="font-size:10px;color:var(--muted);">${av.fecha} ¬∑ <span class="bd bd-gray">${av.tipo}</span></div></div>
      </div>`).join('')}
    </div>
  </div>
</div>`;
}

function renderAluCalif() {
  const prom = (DB.materias.reduce((s,m)=>s+m.nota,0)/DB.materias.length).toFixed(1);
  document.getElementById('pageContent').innerHTML = `
<div class="row g-3 mb-4">
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--green);"></div><div class="stat-val">${prom}</div><div class="stat-label">Promedio General</div></div></div>
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--indigo);"></div><div class="stat-val">${DB.materias.filter(m=>m.nota>=90).length}</div><div class="stat-label">Notas A (90-100)</div></div></div>
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--amber);"></div><div class="stat-val">${DB.materias.filter(m=>m.nota>=70&&m.nota<90).length}</div><div class="stat-label">Notas B (70-89)</div></div></div>
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--red);"></div><div class="stat-val">${DB.materias.filter(m=>m.nota<70).length}</div><div class="stat-label">En Riesgo</div></div></div>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-award me-2"></i>Calificaciones Detalladas ¬∑ III Parcial 2026</span><span class="bd bd-violet">9¬∞ Grado "B"</span></div>
  <div style="overflow-x:auto;">
  <table class="tbl">
    <thead><tr><th>Materia</th><th>Docente</th><th>I Parcial</th><th>II Parcial</th><th>III Parcial</th><th>Promedio</th><th>Estado</th></tr></thead>
    <tbody>${DB.materias.map(m=>{
      const p1=Math.max(60,m.nota-Math.floor(Math.random()*10));
      const p2=Math.max(60,m.nota-Math.floor(Math.random()*8));
      const pr=((p1+p2+m.nota)/3).toFixed(0);
      return `<tr>
        <td style="font-weight:700;">${m.nombre}</td><td style="color:var(--muted);font-size:12px;">${m.docente}</td>
        <td><div class="cal-box ${noteBg(p1)} d-inline-flex" style="width:34px;height:34px;">${p1}</div></td>
        <td><div class="cal-box ${noteBg(p2)} d-inline-flex" style="width:34px;height:34px;">${p2}</div></td>
        <td><div class="cal-box ${noteBg(m.nota)} d-inline-flex" style="width:34px;height:34px;">${m.nota}</div></td>
        <td style="font-weight:800;font-size:16px;color:${noteCol(+pr)};">${pr}</td>
        <td><span class="bd ${m.nota>=70?'bd-green':'bd-red'}">${m.nota>=70?'Aprobado':'Reprobado'}</span></td>
      </tr>`;
    }).join('')}</tbody>
  </table></div>
</div>`;
}

function renderAluAsist() {
  const presentes = DB.asistencia.filter(r=>r.estado==='Presente').length;
  const ausentes  = DB.asistencia.filter(r=>r.estado==='Ausente').length;
  const tardanzas = DB.asistencia.filter(r=>r.estado==='Tardanza').length;
  document.getElementById('pageContent').innerHTML = `
<div class="row g-3 mb-4">
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--green);"></div><div class="stat-val">94%</div><div class="stat-label">Asistencia</div></div></div>
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--indigo);"></div><div class="stat-val">${presentes}</div><div class="stat-label">D√≠as Presente</div></div></div>
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--red);"></div><div class="stat-val">${ausentes}</div><div class="stat-label">Ausencias</div></div></div>
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--amber);"></div><div class="stat-val">${tardanzas}</div><div class="stat-label">Tardanzas</div></div></div>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-clipboard-check me-2"></i>Registro de Asistencia</span><span class="bd bd-blue">Feb‚ÄìMar 2026</span></div>
  <table class="tbl"><thead><tr><th>Fecha</th><th>D√≠a</th><th>Estado</th><th>Observaci√≥n</th></tr></thead>
  <tbody>${DB.asistencia.map(r=>`<tr>
    <td style="font-family:'JetBrains Mono';font-size:12px;">${r.fecha}</td>
    <td>${r.dia}</td>
    <td><span class="bd ${asistBd(r.estado)}">${r.estado}</span></td>
    <td style="color:var(--muted);font-size:12px;">${r.obs||'‚Äî'}</td>
  </tr>`).join('')}</tbody></table>
</div>`;
}

function renderAluTareas() {
  document.getElementById('pageContent').innerHTML = `
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-journal-text me-2"></i>Mis Tareas y Actividades</span><span class="bd bd-amber">${DB.tareas.filter(t=>t.estado==='Pendiente').length} pendientes</span></div>
  <table class="tbl"><thead><tr><th>Tarea</th><th>Materia</th><th>Fecha Inicio</th><th>Fecha l√≠mite</th><th>Puntos</th><th>Estado</th><th>Acciones</th></tr></thead>
  <tbody>${DB.tareas.map(t=>`<tr>
    <td style="font-weight:700;">${t.titulo}</td>
    <td>${t.materia}</td>
   <td><span style="display:inline-flex;align-items:center;gap:5px;font-size:12px;font-family:'JetBrains Mono';"><i class="bi bi-calendar-plus" style="color:var(--green);"></i>${t.fechaIni||'‚Äî'}</span></td>
<td><span style="display:inline-flex;align-items:center;gap:5px;font-size:12px;font-family:'JetBrains Mono';"><i class="bi bi-calendar-check" style="color:var(--red);"></i>${t.fecha}</span></td>
    <td><span class="bd bd-blue">${t.pts} pts</span></td>
    <td><span class="bd ${t.estado==='Entregado'?'bd-green':'bd-amber'}">${t.estado}</span></td>
    <td><div class="d-flex gap-1"><button class="btn-ico" onclick="toast('Marcando como entregada...','ok')" aria-label="Marcar como entregada"><i class="bi bi-check2"></i></button></div></td>
  </tr>`).join('')}</tbody></table>
</div>`;
}

function renderAluDocentes() {
  document.getElementById('pageContent').innerHTML = `
<div class="row g-3">
${DB.docentes.map(d=>`
<div class="col-12 col-md-6">
  <div class="card-base cbp d-flex gap-3 align-items-center">
    ${avatarBox(d.nombre, '', 44)}
    <div style="flex:1;">
      <div style="font-size:14px;font-weight:800;">${d.nombre}</div>
      <div style="font-size:12px;color:var(--muted);">${d.esp}</div>
      <div style="font-size:11px;margin-top:4px;">${d.email}</div>
    </div>
    <span class="bd bd-green">${d.estado}</span>
  </div>
</div>`).join('')}
</div>`;
}

function renderAluPagos() {
  const pendiente = DB.pagos.find(p=>p.alumno==='Kevin Mart√≠nez'&&p.estado==='Pagado');
  document.getElementById('pageContent').innerHTML = `
<div class="row g-3 mb-4">
  <div class="col-12 col-md-5">
    <div class="acct-hero" style="background:linear-gradient(135deg,#065F46,#059669,#34D399);">
      <div class="hero-type">Estado de Cuenta</div>
      <div class="hero-num">2024-0031 ¬∑ Kevin Mart√≠nez</div>
      <div class="hero-name">L 0.00</div>
      <div class="hero-k" style="margin-top:8px;">Saldo pendiente</div>
      <span class="bd bd-green mt-3 d-inline-block">Al d√≠a ‚úì</span>
    </div>
  </div>
  <div class="col-12 col-md-7">
    <div class="card-base h-100">
      <div class="chr"><span class="ct">Historial de Pagos</span></div>
      <table class="tbl"><thead><tr><th>Referencia</th><th>Concepto</th><th>Monto</th><th>Fecha</th><th>Estado</th><th>Acciones</th></tr></thead>
      <tbody>${DB.pagos.filter(p=>p.alumno==='Kevin Mart√≠nez').map(p=>`<tr>
        <td style="font-family:'JetBrains Mono';font-size:11px;color:var(--muted);">${p.ref}</td>
        <td style="font-weight:600;">${p.concepto}</td>
        <td style="font-weight:700;">L ${p.monto.toLocaleString()}</td>
        <td style="font-size:12px;">${p.fecha}</td>
        <td><span class="bd ${p.estado==='Pagado'?'bd-green':'bd-red'}">${p.estado}</span></td>
        <td><button class="btn-ico" onclick="verDetallePago('${p.ref}')" aria-label="Ver detalle"><i class="bi bi-eye"></i></button></td>
      </tr>`).join('')}</tbody></table>
    </div>
  </div>
</div>`;
}

function renderAluPerfil() {
  const a = DB.alumnos[0];
  document.getElementById('pageContent').innerHTML = `
<div class="row g-4">
  <div class="col-12 col-md-4">
    <div class="card-base cbp text-center">
      ${avatarBox(a.nombre,'',72)}
      <div style="margin-top:12px;font-size:16px;font-weight:800;">${a.nombre}</div>
      <div style="font-size:13px;color:var(--muted);">${a.grado}</div>
      <span class="bd bd-green mt-2 d-inline-block">Activo</span>
      <div class="row g-3 mt-3">
        <div class="col-6"><div class="stat-card"><div class="stat-val" style="font-size:18px;">${(DB.materias.reduce((s,m)=>s+m.nota,0)/DB.materias.length).toFixed(1)}</div><div class="stat-label">Promedio</div></div></div>
        <div class="col-6"><div class="stat-card"><div class="stat-val" style="font-size:18px;">${a.asistencia}%</div><div class="stat-label">Asistencia</div></div></div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-8">
    <div class="card-base">
      <div class="chr"><span class="ct">Datos Personales</span></div>
      <div class="cbp">
      <div class="row g-3">
        <div class="col-12 col-md-6"><label class="form-label">Nombre completo</label><input class="form-control" value="${a.nombre}" readonly style="background:#F8FAFC;"></div>
        <div class="col-12 col-md-6"><label class="form-label">C√≥digo de alumno</label><input class="form-control" value="${a.codigo}" readonly style="background:#F8FAFC;font-family:'JetBrains Mono';"></div>
        <div class="col-12 col-md-6"><label class="form-label">Grado</label><input class="form-control" value="${a.grado}" readonly style="background:#F8FAFC;"></div>
        <div class="col-12 col-md-6"><label class="form-label">Nombre del tutor</label><input class="form-control" value="${a.tutor}" readonly style="background:#F8FAFC;"></div>
        <div class="col-12 col-md-6"><label class="form-label">Correo del portal</label><input class="form-control" value="km2024@isanmarcos.edu" readonly style="background:#F8FAFC;"></div>
        <div class="col-12 col-md-6"><label class="form-label">A√±o escolar</label><input class="form-control" value="2026" readonly style="background:#F8FAFC;"></div>
      </div>
      <div class="info-box mt-3"><i class="bi bi-lock me-1" aria-hidden="true"></i>Para actualizar datos contacta a Direcci√≥n Acad√©mica.</div>
      </div>
    </div>
  </div>
</div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  MAESTRO VIEWS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderMaeInicio() {
  document.getElementById('pageContent').innerHTML = `
<div class="row g-3 mb-4">
  <div class="col-12 col-lg-8">
    <div class="acct-hero" style="background:linear-gradient(135deg,#78350F,#D97706,#FCD34D);">
      <div class="hero-type">Panel del Docente</div>
      <div class="hero-num">2026 ¬∑ III Parcial</div>
      <div class="hero-name">Prof. Ana Mej√≠a</div>
      <div class="hero-meta">
        <div class="hero-kv"><span class="hero-k">Materia</span><span class="hero-v" style="font-size:14px;margin-top:2px;">Matem√°ticas</span></div>
        <div style="border-left:1px solid rgba(255,255,255,.2);"></div>
        <div class="hero-kv"><span class="hero-k">Alumnos</span><span class="hero-v">${DB.misAlumnos.length}</span></div>
        <div style="border-left:1px solid rgba(255,255,255,.2);"></div>
        <div class="hero-kv"><span class="hero-k">Tareas activas</span><span class="hero-v">${DB.misTareas.length}</span></div>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-4">
    <div class="row g-3 h-100">
      <div class="col-6 col-lg-12"><div class="stat-card"><div class="stat-top" style="background:var(--red);"></div><div class="stat-val">${DB.misAlumnos.filter(a=>a.estado==='En riesgo').length}</div><div class="stat-label">Alumnos en Riesgo</div></div></div>
      <div class="col-6 col-lg-12"><div class="stat-card"><div class="stat-top" style="background:var(--amber);"></div><div class="stat-val">${DB.misTareas.filter(t=>t.entregadas<t.total).length}</div><div class="stat-label">Tareas sin completar</div></div></div>
    </div>
  </div>
</div>
<div class="row g-4">
  <div class="col-12 col-md-7">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-people me-2"></i>Mis Alumnos</span><button class="btn-sec btn-sm" onclick="goSection('mae_misalumnos')">Ver todos</button></div>
      <table class="tbl"><thead><tr><th>Alumno</th><th>Grado</th><th>√öltima nota</th><th>Asistencia</th><th>Estado</th><th>Acciones</th></tr></thead>
      <tbody>${DB.misAlumnos.map(a=>`<tr>
        <td style="font-weight:700;">${a.nombre}</td><td>${a.grado}</td>
        <td><div class="cal-box ${noteBg(a.ultima)} d-inline-flex" style="width:34px;height:34px;">${a.ultima}</div></td>
        <td style="font-weight:700;color:${a.asistencia>=90?'var(--green)':a.asistencia>=80?'var(--amber)':'var(--red)'};">${a.asistencia}%</td>
        <td><span class="bd ${a.estado==='Activo'?'bd-green':'bd-red'}">${a.estado}</span></td>
        <td><button class="btn-ico" onclick="editarAlumno('${a.codigo}')" aria-label="Editar"><i class="bi bi-pencil"></i></button></td>
      </tr>`).join('')}</tbody></table>
    </div>
  </div>
  <div class="col-12 col-md-5">
    <div class="card-base mb-3">
      <div class="chr"><span class="ct"><i class="bi bi-journal-text me-2"></i>Mis Tareas</span><button class="btn-sec btn-sm" onclick="goSection('mae_tareas')">Ver todo</button></div>
      ${DB.misTareas.map(t=>`
      <div class="tx-row">
        <div class="tx-ico" style="background:#FEF3C7;"><i class="bi bi-journal-text text-warning"></i></div>
        <div style="flex:1;"><div style="font-size:12px;font-weight:700;">${t.titulo}</div><div style="font-size:10px;color:var(--muted);">${t.grado} ¬∑ ${t.fecha}</div></div>
        <span class="bd ${t.entregadas>=t.total?'bd-green':'bd-amber'}" style="white-space:nowrap;">${t.entregadas}/${t.total}</span>
        <button class="btn-ico" onclick="editarTarea('${t.titulo}')" aria-label="Editar tarea"><i class="bi bi-pencil"></i></button>
      </div>`).join('')}
    </div>
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-zap me-2"></i>Acciones R√°pidas</span></div>
      <div class="cbp d-flex flex-column gap-2">
        <button class="btn-pri btn-amber" onclick="modals.mCalif.show()"><i class="bi bi-pencil-square me-2" aria-hidden="true"></i>Registrar Calificaci√≥n</button>
        <button class="btn-pri" onclick="modals.mTarea.show()"><i class="bi bi-journal-plus me-2" aria-hidden="true"></i>Asignar Tarea</button>
        <button class="btn-pri btn-teal" onclick="modals.mAsistencia.show()"><i class="bi bi-clipboard-check me-2" aria-hidden="true"></i>Pasar Asistencia</button>
        <button class="btn-sec" onclick="modals.mAviso.show()"><i class="bi bi-megaphone me-2" aria-hidden="true"></i>Publicar Aviso</button>
      </div>
    </div>
  </div>
</div>`;
}

function renderMaeAlumnos() {
  document.getElementById('pageContent').innerHTML = `
<div class="d-flex gap-2 mb-3">
  <div class="sw flex-grow-1"><i class="si bi bi-search" aria-hidden="true"></i><input type="text" class="form-control" placeholder="Buscar alumno..." onkeyup="filtrarMaeAlumnos(this.value)"></div>
  <button class="btn-pri btn-amber" onclick="modals.mCalif.show()"><i class="bi bi-pencil me-1" aria-hidden="true"></i>Registrar Nota</button>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-people me-2" aria-hidden="true"></i>Mis Alumnos ¬∑ Matem√°ticas</span><span class="bd bd-amber" id="maeAlumCount">${DB.misAlumnos.length} alumnos</span></div>
  <table class="tbl"><thead><tr><th>C√≥digo</th><th>Alumno</th><th>Grado</th><th>√öltima Nota</th><th>Asistencia</th><th>Estado</th><th>Acciones</th></tr></thead>
  <tbody id="tbMaeAlum">${DB.misAlumnos.map(a=>`<tr>
    <td style="font-family:'JetBrains Mono';font-size:11px;color:var(--muted);">${a.codigo}</td>
    <td style="font-weight:700;">${a.nombre}</td>
    <td>${a.grado}</td>
    <td><div class="cal-box ${noteBg(a.ultima)} d-inline-flex" style="width:34px;height:34px;">${a.ultima}</div></td>
    <td style="font-weight:700;color:${a.asistencia>=90?'var(--green)':a.asistencia>=80?'var(--amber)':'var(--red)'};">${a.asistencia}%</td>
    <td><span class="bd ${a.estado==='Activo'?'bd-green':'bd-red'}">${a.estado}</span></td>
    <td><div class="d-flex gap-1"><button class="btn-ico" onclick="modals.mCalif.show()" title="Agregar nota" aria-label="Agregar nota"><i class="bi bi-pencil"></i></button><button class="btn-ico" onclick="verDetalleAlumno('${a.codigo}')" aria-label="Ver detalle"><i class="bi bi-eye"></i></button></div></td>
  </tr>`).join('')}</tbody></table>
</div>`;
}

function filtrarMaeAlumnos(q) {
  q = q.toLowerCase();
  document.querySelectorAll('#tbMaeAlum tr').forEach(r => {
    r.style.display = r.textContent.toLowerCase().includes(q) ? '' : 'none';
  });
}

function renderMaeCalif() {
  document.getElementById('pageContent').innerHTML = `
<div class="d-flex gap-2 mb-3">
  <div class="sw flex-grow-1"><i class="si bi bi-search" aria-hidden="true"></i><input type="text" class="form-control" placeholder="Buscar alumno o materia..." onkeyup="filtrarMaeCalif(this.value)"></div>
  <button class="btn-pri btn-amber" onclick="modals.mCalif.show()"><i class="bi bi-plus me-1" aria-hidden="true"></i>Registrar Nota</button>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-pencil-square me-2" aria-hidden="true"></i>Calificaciones ¬∑ Matem√°ticas</span></div>
  <table class="tbl"><thead><tr><th>Alumno</th><th>Grado</th><th>I Parcial</th><th>II Parcial</th><th>III Parcial</th><th>Promedio</th><th>Estado</th><th>Acciones</th></tr></thead>
  <tbody id="tbMaeCalif">${DB.misAlumnos.map(a=>{
    const p1=Math.max(60,a.ultima-8); const p2=Math.max(60,a.ultima-4);
    const pr=((p1+p2+a.ultima)/3).toFixed(0);
    return `<tr data-alumno="${a.nombre.toLowerCase()} ${a.codigo.toLowerCase()}">
      <td style="font-weight:700;">${a.nombre}</td><td>${a.grado}</td>
      <td><div class="cal-box ${noteBg(p1)} d-inline-flex" style="width:34px;height:34px;">${p1}</div></td>
      <td><div class="cal-box ${noteBg(p2)} d-inline-flex" style="width:34px;height:34px;">${p2}</div></td>
      <td><div class="cal-box ${noteBg(a.ultima)} d-inline-flex" style="width:34px;height:34px;">${a.ultima}</div></td>
      <td style="font-weight:800;color:${noteCol(+pr)};">${pr}</td>
      <td><span class="bd ${+pr>=70?'bd-green':'bd-red'}">${+pr>=70?'Aprobado':'Reprobado'}</span></td>
      <td><button class="btn-ico" onclick="editarCalificacion('${a.codigo}')" aria-label="Editar"><i class="bi bi-pencil"></i></button></td>
    </tr>`;
  }).join('')}</tbody></table>
</div>`;
}

function filtrarMaeCalif(q) {
  q = q.toLowerCase();
  document.querySelectorAll('#tbMaeCalif tr').forEach(r => {
    r.style.display = r.getAttribute('data-alumno')?.includes(q) ? '' : 'none';
  });
}

function renderMaeAsist() {
  const today = new Date().toLocaleDateString('es-HN');
  document.getElementById('pageContent').innerHTML = `
<div class="d-flex gap-2 mb-3">
  <input type="date" class="form-control" style="max-width:200px;" value="${new Date().toISOString().split('T')[0]}" id="asistFecha" aria-label="Fecha de asistencia">
  <select class="form-select" style="max-width:180px;" id="asistGrado" aria-label="Seleccionar grado"><option selected>9¬∞ Grado B</option><option>9¬∞ Grado A</option><option>8¬∞ C</option></select>
  <button class="btn-pri btn-teal" onclick="guardarAsistenciaMasiva()"><i class="bi bi-save me-1" aria-hidden="true"></i>Guardar Asistencia</button>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-clipboard-check me-2" aria-hidden="true"></i>Pasar Asistencia ¬∑ 9¬∞ B</span><span class="bd bd-teal" id="fechaAsistDisplay">Hoy ${new Date().toLocaleDateString('es-HN')}</span></div>
  <table class="tbl"><thead><tr><th>Alumno</th><th>Estado</th><th>Observaci√≥n</th></tr></thead>
  <tbody id="tbAsistencia">${DB.misAlumnos.map((a,i)=>`<tr>
    <td><div style="font-weight:700;">${a.nombre}</div><div style="font-size:11px;color:var(--muted);">${a.codigo}</div></td>
    <td>
      <select class="form-select form-select-sm" style="width:140px;" data-alumno="${a.codigo}" id="asist_${a.codigo}">
        <option ${i!==2?'selected':''}>Presente</option>
        <option ${i===2?'selected':''}>Ausente</option>
        <option>Tardanza</option>
        <option>Justificado</option>
      </select>
    </td>
    <td><input type="text" class="form-control form-control-sm" placeholder="Opcional..." style="max-width:200px;" id="obs_${a.codigo}" value="${i===2?'Sin justificaci√≥n':''}"></td>
  </tr>`).join('')}</tbody></table>
</div>`;
}

function guardarAsistenciaMasiva() {
  const fechaInput = document.getElementById('asistFecha').value;
  if (!fechaInput) {
    toast('Selecciona una fecha', 'err');
    return;
  }
  
  const fechaParts = fechaInput.split('-');
  const fechaFormateada = `${fechaParts[2]}/${fechaParts[1]}/${fechaParts[0]}`;
  const diasSemana = ['Domingo','Lunes','Martes','Mi√©rcoles','Jueves','Viernes','S√°bado'];
  const dia = diasSemana[new Date(fechaInput).getDay()];
  
  DB.misAlumnos.forEach(a => {
    const estadoSelect = document.getElementById(`asist_${a.codigo}`);
    const obsInput = document.getElementById(`obs_${a.codigo}`);
    if (estadoSelect) {
      DB.asistencia.unshift({
        fecha: fechaFormateada,
        dia: dia,
        estado: estadoSelect.value,
        obs: obsInput?.value || ''
      });
    }
  });
  
  // Limitar a los √∫ltimos 50 registros para no saturar
  if (DB.asistencia.length > 50) DB.asistencia = DB.asistencia.slice(0, 50);
  
  saveToStorage();
  toast('Asistencia guardada correctamente', 'ok');
}

function renderMaeTareas() {
  document.getElementById('pageContent').innerHTML = `
<div class="d-flex gap-2 mb-3">
  <div class="sw flex-grow-1"><i class="si bi bi-search" aria-hidden="true"></i><input class="form-control" placeholder="Buscar tarea..." onkeyup="filtrarMaeTareas(this.value)"></div>
  <button class="btn-pri btn-amber" onclick="modals.mTarea.show()"><i class="bi bi-plus me-1" aria-hidden="true"></i>Nueva Tarea</button>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-journal-text me-2" aria-hidden="true"></i>Tareas y Ex√°menes</span></div>
  <table class="tbl"><thead><tr><th>T√≠tulo</th><th>Materia</th><th>Grado</th><th>Fecha Entrega</th><th>Puntos</th><th>Entregadas</th><th>Acciones</th></tr></thead>
  <tbody id="tbMaeTareas">${DB.misTareas.map(t=>`<tr>
    <td style="font-weight:700;">${t.titulo}</td>
    <td>${t.materia}</td>
    <td><span class="bd bd-blue">${t.grado}</span></td>
    <td><span style="display:inline-flex;align-items:center;gap:5px;font-size:12px;font-family:'JetBrains Mono';"><i class="bi bi-calendar-check" style="color:var(--red);"></i>${t.fecha}</span></td>
    <td><span class="bd bd-violet">${t.pts} pts</span></td>
    <td>
      <div class="d-flex align-items-center gap-2">
        <div class="prog-wrap" style="width:60px;"><div class="prog-bar" style="width:${Math.round(t.entregadas/t.total*100)}%;background:${t.entregadas>=t.total?'var(--green)':'var(--amber)'}"></div></div>
        <span style="font-size:12px;font-weight:700;">${t.entregadas}/${t.total}</span>
      </div>
    </td>
    <td><div class="d-flex gap-1"><button class="btn-ico" onclick="editarTarea('${t.titulo}')" aria-label="Editar"><i class="bi bi-pencil"></i></button><button class="btn-ico" onclick="eliminarTarea('${t.titulo}')" aria-label="Eliminar"><i class="bi bi-trash text-danger"></i></button></div></td>
  </tr>`).join('')}</tbody></table>
</div>`;
}

function filtrarMaeTareas(q) {
  q = q.toLowerCase();
  document.querySelectorAll('#tbMaeTareas tr').forEach(r => {
    r.style.display = r.textContent.toLowerCase().includes(q) ? '' : 'none';
  });
}

function renderMaeReportes() {
  document.getElementById('pageContent').innerHTML = `
<div class="row g-4">
  <div class="col-12 col-md-6">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-graph-up me-2" aria-hidden="true"></i>Distribuci√≥n de Notas ¬∑ Matem√°ticas</span></div>
      <div class="cbp">
        ${(() => {
          const alumnosRendimiento = {
            '90-100': DB.misAlumnos.filter(a => a.ultima >= 90).length,
            '80-89': DB.misAlumnos.filter(a => a.ultima >= 80 && a.ultima < 90).length,
            '70-79': DB.misAlumnos.filter(a => a.ultima >= 70 && a.ultima < 80).length,
            '<70': DB.misAlumnos.filter(a => a.ultima < 70).length
          };
          return [['90-100','A','bd-green',alumnosRendimiento['90-100']],['80-89','B','bd-blue',alumnosRendimiento['80-89']],['70-79','C','bd-amber',alumnosRendimiento['70-79']],['<70','D/F','bd-red',alumnosRendimiento['<70']]].map(([r,g,b,c]) => `
          <div class="d-flex align-items-center gap-3 mb-3">
            <div style="width:50px;font-size:11px;font-weight:700;">${r}</div>
            <div class="prog-wrap" style="flex:1;height:10px;"><div class="prog-bar" style="width:${c/DB.misAlumnos.length*100}%;background:var(--indigo);height:10px;"></div></div>
            <span class="bd ${b}">${c} alumnos</span>
          </div>`).join('');
        })()}
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-download me-2" aria-hidden="true"></i>Exportar</span></div>
      <div class="cbp d-flex flex-column gap-2">
        <button class="btn-pri w-100" onclick="exportarReporte('calificaciones')"><i class="bi bi-file-earmark-spreadsheet me-2" aria-hidden="true"></i>Calificaciones (Excel)</button>
        <button class="btn-sec w-100" onclick="exportarReporte('asistencia')"><i class="bi bi-file-earmark-pdf me-2" aria-hidden="true"></i>Asistencia (PDF)</button>
        <button class="btn-sec w-100" onclick="exportarReporte('tareas')"><i class="bi bi-journal me-2" aria-hidden="true"></i>Tareas y Actividades</button>
      </div>
    </div>
  </div>
</div>`;
}

function exportarReporte(tipo) {
  toast(`Reporte de ${tipo} exportado correctamente`, 'ok');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  ADMIN VIEWS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderAdmInicio() {
  const prom = (DB.alumnos.reduce((s,a)=>s+a.promedio,0)/DB.alumnos.length).toFixed(1);
  document.getElementById('pageContent').innerHTML = `
<div class="row g-3 mb-4">
  <div class="col-6 col-lg-3"><div class="stat-card"><div class="stat-top" style="background:var(--indigo);"></div><div class="stat-val">${DB.alumnos.length}</div><div class="stat-label">Alumnos Activos</div><div class="stat-sub text-success">‚Üë 3 este mes</div></div></div>
  <div class="col-6 col-lg-3"><div class="stat-card"><div class="stat-top" style="background:var(--green);"></div><div class="stat-val">${DB.docentes.length}</div><div class="stat-label">Docentes</div><div class="stat-sub text-muted">Todos activos</div></div></div>
  <div class="col-6 col-lg-3"><div class="stat-card"><div class="stat-top" style="background:var(--amber);"></div><div class="stat-val">${prom}</div><div class="stat-label">Promedio Institucional</div></div></div>
  <div class="col-6 col-lg-3"><div class="stat-card"><div class="stat-top" style="background:var(--red);"></div><div class="stat-val">${DB.alumnos.filter(a=>a.estado==='En riesgo').length}</div><div class="stat-label">Alumnos en Riesgo</div><div class="stat-sub text-danger">Requieren atenci√≥n</div></div></div>
</div>
<div class="row g-4">
  <div class="col-12 col-lg-8">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-people me-2" aria-hidden="true"></i>Alumnos Recientes</span><button class="btn-sec btn-sm" onclick="goSection('adm_alumnos')">Ver todos</button></div>
      <table class="tbl"><thead><tr><th>Alumno</th><th>Grado</th><th>Promedio</th><th>Asistencia</th><th>Estado</th><th>Acciones</th></tr></thead>
      <tbody>${DB.alumnos.slice(0,6).map(a=>`<tr>
        <td><div style="font-weight:700;">${a.nombre}</div><div style="font-size:11px;color:var(--muted);">${a.codigo}</div></td>
        <td>${a.grado}</td>
        <td style="font-weight:800;color:${noteCol(a.promedio)};">${a.promedio}</td>
        <td><span style="font-weight:700;color:${a.asistencia>=90?'var(--green)':a.asistencia>=80?'var(--amber)':'var(--red)'};">${a.asistencia}%</span></td>
        <td><span class="bd ${a.estado==='Activo'?'bd-green':'bd-red'}">${a.estado}</span></td>
        <td><div class="d-flex gap-1"><button class="btn-ico" onclick="verAlumnoModal('${a.codigo}')" aria-label="Ver detalle"><i class="bi bi-eye"></i></button><button class="btn-ico" onclick="editarAlumno('${a.codigo}')" aria-label="Editar"><i class="bi bi-pencil"></i></button></div></td>
      </tr>`).join('')}</tbody></table>
    </div>
  </div>
  <div class="col-12 col-lg-4">
    <div class="card-base mb-3">
      <div class="chr"><span class="ct"><i class="bi bi-zap me-2" aria-hidden="true"></i>Acciones R√°pidas</span></div>
      <div class="cbp d-flex flex-column gap-2">
        <button class="btn-pri" onclick="modals.mNuevoAlumno.show()"><i class="bi bi-person-plus me-2" aria-hidden="true"></i>Registrar Alumno</button>
        <button class="btn-pri btn-green" onclick="modals.mNuevoDocente.show()"><i class="bi bi-person-badge me-2" aria-hidden="true"></i>Registrar Docente</button>
        <button class="btn-pri btn-amber" onclick="modals.mCalif.show()"><i class="bi bi-pencil-square me-2" aria-hidden="true"></i>Registrar Calificaci√≥n</button>
        <button class="btn-pri btn-teal" onclick="modals.mAsistencia.show()"><i class="bi bi-clipboard-check me-2" aria-hidden="true"></i>Registrar Asistencia</button>
        <button class="btn-sec" onclick="modals.mAviso.show()"><i class="bi bi-megaphone me-2" aria-hidden="true"></i>Publicar Aviso</button>
      </div>
    </div>
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-bell me-2" aria-hidden="true"></i>Avisos Activos</span></div>
      ${DB.avisos.slice(0,4).map(av=>`
      <div class="notice-item">
        <div class="notice-dot" style="background:${av.color};"></div>
        <div><div style="font-size:12px;font-weight:700;">${av.titulo}</div><div style="font-size:10px;color:var(--muted);">${av.fecha}</div></div>
      </div>`).join('')}
    </div>
  </div>
</div>`;
}

function renderAdmAlumnos() {
  document.getElementById('pageContent').innerHTML = `
<div class="d-flex gap-2 mb-3">
  <div class="sw flex-grow-1"><i class="si bi bi-search" aria-hidden="true"></i><input type="text" class="form-control" id="srchAlum" placeholder="Buscar por nombre o c√≥digo..." onkeyup="filtrarAlumnos()" aria-label="Buscar alumno"></div>
  <button class="btn-pri" onclick="modals.mNuevoAlumno.show()"><i class="bi bi-plus me-1" aria-hidden="true"></i>Nuevo Alumno</button>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-people me-2" aria-hidden="true"></i>Listado de Alumnos</span><span class="bd bd-blue" id="alumCount">${DB.alumnos.length} registros</span></div>
  <div style="overflow-x:auto;">
  <table class="tbl"><thead><tr><th>C√≥digo</th><th>Alumno</th><th>Grado</th><th>Promedio</th><th>Asistencia</th><th>Estado</th><th>Acciones</th></tr></thead>
  <tbody id="tbAlum">${DB.alumnos.map(a=>`<tr>
    <td style="font-family:'JetBrains Mono';font-size:11px;color:var(--muted);">${a.codigo}</td>
    <td style="font-weight:700;">${a.nombre}</td>
    <td>${a.grado}</td>
    <td style="font-weight:800;color:${noteCol(a.promedio)};">${a.promedio}</td>
    <td><div class="d-flex align-items-center gap-2"><div class="prog-wrap" style="width:50px;"><div class="prog-bar" style="width:${a.asistencia}%;background:${a.asistencia>=90?'var(--green)':a.asistencia>=80?'var(--amber)':'var(--red)'};"></div></div>${a.asistencia}%</div></td>
    <td><span class="bd ${a.estado==='Activo'?'bd-green':'bd-red'}">${a.estado}</span></td>
    <td><div class="d-flex gap-1"><button class="btn-ico" onclick="verAlumnoModal('${a.codigo}')" aria-label="Ver detalle"><i class="bi bi-eye"></i></button><button class="btn-ico" onclick="editarAlumno('${a.codigo}')" aria-label="Editar"><i class="bi bi-pencil"></i></button><button class="btn-ico" onclick="eliminarAlumno('${a.codigo}')" aria-label="Eliminar"><i class="bi bi-trash text-danger"></i></button></div></td>
  </tr>`).join('')}</tbody></table></div>
</div>`;
}

function filtrarAlumnos() {
  const q = document.getElementById('srchAlum').value.toLowerCase();
  document.querySelectorAll('#tbAlum tr').forEach(r => { 
    r.style.display = r.textContent.toLowerCase().includes(q)?'':'none'; 
  });
  document.getElementById('alumCount').textContent = document.querySelectorAll('#tbAlum tr:not([style*="display: none"])').length + ' registros';
}

function verAlumnoModal(codigo) {
  const a = DB.alumnos.find(x=>x.codigo===codigo);
  if(!a) return;
  document.getElementById('mVerAlumnoBody').innerHTML = `
    <div class="d-flex gap-3 align-items-center mb-4">${avatarBox(a.nombre,'',52)}
      <div><div style="font-size:15px;font-weight:800;">${a.nombre}</div><div style="font-size:12px;color:var(--muted);">${a.codigo} ¬∑ ${a.grado}</div><span class="bd ${a.estado==='Activo'?'bd-green':'bd-red'} mt-1 d-inline-block">${a.estado}</span></div>
    </div>
    <div class="row g-3 mb-3">
      <div class="col-6"><div class="stat-card"><div class="stat-val" style="font-size:22px;color:${noteCol(a.promedio)};">${a.promedio}</div><div class="stat-label">Promedio</div></div></div>
      <div class="col-6"><div class="stat-card"><div class="stat-val" style="font-size:22px;">${a.asistencia}%</div><div class="stat-label">Asistencia</div></div></div>
    </div>
    <div class="row g-2" style="font-size:12px;">
      <div class="col-6"><div class="form-label">Tutor</div><div style="font-weight:700;">${a.tutor}</div></div>
    </div>`;
  modals.mVerAlumno.show();
}

function renderAdmDocentes() {
  document.getElementById('pageContent').innerHTML = `
<div class="d-flex gap-2 mb-3">
  <div class="sw flex-grow-1"><i class="si bi bi-search" aria-hidden="true"></i><input class="form-control" id="srchDoc" placeholder="Buscar docente..." onkeyup="filtrarDocentes()" aria-label="Buscar docente"></div>
  <button class="btn-pri btn-green" onclick="modals.mNuevoDocente.show()"><i class="bi bi-plus me-1" aria-hidden="true"></i>Nuevo Docente</button>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-person-badge me-2" aria-hidden="true"></i>Planta Docente</span><span class="bd bd-green" id="docCount">${DB.docentes.length} docentes</span></div>
  <table class="tbl"><thead><tr><th>Nombre</th><th>Especialidad</th><th>Grados</th><th>Correo</th><th>Tel√©fono</th><th>Ingreso</th><th>Estado</th><th>Acciones</th></tr></thead>
  <tbody id="tbDoc">${DB.docentes.map(d=>`<tr>
    <td style="font-weight:700;">${d.nombre}</td><td>${d.esp}</td>
    <td style="font-size:11px;color:var(--muted);">${d.grados}</td>
    <td style="font-size:12px;">${d.email}</td>
    <td style="font-size:12px;">${d.tel}</td>
    <td style="font-size:12px;font-family:'JetBrains Mono';">${d.ingreso}</td>
    <td><span class="bd bd-green">${d.estado}</span></td>
    <td><div class="d-flex gap-1"><button class="btn-ico" onclick="editarDocente('${d.email}')" aria-label="Editar"><i class="bi bi-pencil"></i></button><button class="btn-ico" onclick="eliminarDocente('${d.email}')" aria-label="Eliminar"><i class="bi bi-trash text-danger"></i></button></div></td>
  </tr>`).join('')}</tbody></table>
</div>`;
}

function filtrarDocentes() {
  const q = document.getElementById('srchDoc').value.toLowerCase();
  document.querySelectorAll('#tbDoc tr').forEach(r => { 
    r.style.display = r.textContent.toLowerCase().includes(q)?'':'none'; 
  });
  document.getElementById('docCount').textContent = document.querySelectorAll('#tbDoc tr:not([style*="display: none"])').length + ' docentes';
}

function renderAdmCalif() {
  document.getElementById('pageContent').innerHTML = `
<div class="d-flex gap-2 mb-3">
  <div class="sw flex-grow-1"><i class="si bi bi-search" aria-hidden="true"></i><input class="form-control" id="srchCalif" placeholder="Buscar alumno o materia..." onkeyup="filtrarCalif()" aria-label="Buscar calificaci√≥n"></div>
  <button class="btn-pri btn-amber" onclick="modals.mCalif.show()"><i class="bi bi-plus me-1" aria-hidden="true"></i>Registrar Nota</button>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-pencil-square me-2" aria-hidden="true"></i>Calificaciones ¬∑ III Parcial 2026</span></div>
  <div style="overflow-x:auto;"><table class="tbl"><thead><tr><th>Alumno</th><th>Materia</th><th>Per√≠odo</th><th>Nota</th><th>Docente</th><th>Fecha</th><th>Estado</th><th>Acciones</th></tr></thead>
  <tbody id="tbCalif">${DB.alumnos.flatMap(a=>DB.materias.slice(0,2).map(m=>({...a,mat:m}))).slice(0,12).map((r, idx)=>{
    const nota = Math.max(55,r.mat.nota-Math.floor(Math.random()*15));
    return `<tr>
      <td><div style="font-weight:700;">${r.nombre}</div><div style="font-size:11px;color:var(--muted);">${r.codigo}</div></td>
      <td>${r.mat.nombre}</td>
      <td><span class="bd bd-violet">III Parcial</span></td>
      <td style="font-weight:800;color:${noteCol(nota)};">${nota}</td>
      <td style="font-size:11px;color:var(--muted);">${r.mat.docente}</td>
      <td style="font-family:'JetBrains Mono';font-size:11px;">27/02/2026</td>
      <td><span class="bd ${nota>=70?'bd-green':'bd-red'}">${nota>=70?'Aprobado':'Reprobado'}</span></td>
      <td><button class="btn-ico" onclick="editarCalificacion('${r.codigo}')" aria-label="Editar"><i class="bi bi-pencil"></i></button></td>
    </tr>`;
  }).join('')}</tbody></table></div>
</div>`;
}

function filtrarCalif() {
  const q = document.getElementById('srchCalif').value.toLowerCase();
  document.querySelectorAll('#tbCalif tr').forEach(r => { 
    r.style.display = r.textContent.toLowerCase().includes(q)?'':'none'; 
  });
}

function renderAdmAsist() {
  document.getElementById('pageContent').innerHTML = `
<div class="d-flex gap-2 mb-3">
  <input type="date" class="form-control" style="max-width:200px;" value="${new Date().toISOString().split('T')[0]}" id="filtroFechaAsist" aria-label="Filtrar por fecha">
  <div class="sw flex-grow-1"><i class="si bi bi-search" aria-hidden="true"></i><input class="form-control" id="srchAsist" placeholder="Buscar alumno..." onkeyup="filtrarAsistencia()" aria-label="Buscar alumno"></div>
  <button class="btn-pri btn-teal" onclick="modals.mAsistencia.show()"><i class="bi bi-plus me-1" aria-hidden="true"></i>Registrar</button>
</div>
<div class="row g-3 mb-3">
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--green);"></div><div class="stat-val">${Math.round(DB.alumnos.reduce((s,a)=>s+a.asistencia,0)/DB.alumnos.length)}%</div><div class="stat-label">Asistencia promedio</div></div></div>
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--indigo);"></div><div class="stat-val">${DB.alumnos.filter(a=>a.asistencia<80).length}</div><div class="stat-label">Asist. &lt;80%</div></div></div>
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--amber);"></div><div class="stat-val">${DB.asistencia.filter(a=>a.estado==='Tardanza').length}</div><div class="stat-label">Tardanzas</div></div></div>
  <div class="col-6 col-md-3"><div class="stat-card"><div class="stat-top" style="background:var(--red);"></div><div class="stat-val">${DB.asistencia.filter(a=>a.estado==='Ausente').length}</div><div class="stat-label">Ausencias</div></div></div>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-clipboard-check me-2" aria-hidden="true"></i>Asistencia por Alumno</span></div>
  <table class="tbl"><thead><tr><th>Alumno</th><th>Grado</th><th>Asistencia total</th><th>Ausencias</th><th>Tardanzas</th><th>√öltimo registro</th><th>Acciones</th></tr></thead>
  <tbody id="tbAsistAdm">${DB.alumnos.map((a,i)=>{
    const aus=Math.round((100-a.asistencia)*0.4);
    const tar=Math.round((100-a.asistencia)*0.2);
    const ultimo = DB.asistencia.find(r => r.estado && true) || {estado:'Presente', fecha:'26/02/2026'};
    return `<tr>
      <td style="font-weight:700;">${a.nombre}</td><td>${a.grado}</td>
      <td><div class="d-flex align-items-center gap-2"><div class="prog-wrap" style="width:60px;"><div class="prog-bar" style="width:${a.asistencia}%;background:${a.asistencia>=90?'var(--green)':a.asistencia>=80?'var(--amber)':'var(--red)'};"></div></div><span style="font-weight:700;">${a.asistencia}%</span></div></td>
      <td style="color:var(--red);font-weight:700;">${aus}</td>
      <td style="color:var(--amber);font-weight:700;">${tar}</td>
      <td><span class="bd ${asistBd(ultimo.estado)}">${ultimo.estado}</span> <span class="text-muted">${ultimo.fecha}</span></td>
      <td><button class="btn-ico" onclick="verHistorialAsistencia('${a.codigo}')" aria-label="Ver historial"><i class="bi bi-clock-history"></i></button></td>
    </tr>`;
  }).join('')}</tbody></table>
</div>`;
}

function filtrarAsistencia() {
  const q = document.getElementById('srchAsist').value.toLowerCase();
  document.querySelectorAll('#tbAsistAdm tr').forEach(r => { 
    r.style.display = r.textContent.toLowerCase().includes(q)?'':'none'; 
  });
}

function verHistorialAsistencia(codigo) {
  toast(`Mostrando historial de asistencia para alumno ${codigo}`, 'ok');
}

function renderAdmTareas() {
  document.getElementById('pageContent').innerHTML = `
<div class="d-flex gap-2 mb-3">
  <div class="sw flex-grow-1"><i class="si bi bi-search" aria-hidden="true"></i><input class="form-control" id="srchTarea" placeholder="Buscar tarea o actividad..." onkeyup="filtrarTareas()" aria-label="Buscar tarea"></div>
  <button class="btn-pri btn-amber" onclick="modals.mTarea.show()"><i class="bi bi-plus me-1" aria-hidden="true"></i>Nueva Tarea</button>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-journal-text me-2" aria-hidden="true"></i>Tareas y Actividades Institucionales</span><span class="bd bd-blue" id="tareaCount">${DB.tareas.length + DB.misTareas.length} registros</span></div>
  <table class="tbl"><thead><tr><th>Tarea</th><th>Materia</th><th>Grado</th><th>Fecha</th><th>Puntos</th><th>Entregadas</th><th>Estado</th><th>Acciones</th></tr></thead>
  <tbody id="tbTareas">${[...DB.misTareas,...DB.tareas.slice(0,3)].map(t=>`<tr>
    <td style="font-weight:700;">${t.titulo}</td>
    <td>${t.materia}</td>
    <td><span class="bd bd-blue">${t.grado||'9¬∞ B'}</span></td>
    <td style="font-size:12px;font-family:'JetBrains Mono';">${t.fecha}</td>
    <td><span class="bd bd-violet">${t.pts} pts</span></td>
    <td>${t.total?`<span style="font-weight:700;">${t.entregadas||0}/${t.total}</span>`:'<span class="bd bd-gray">N/A</span>'}</td>
    <td><span class="bd ${t.estado==='Entregado'||t.entregadas===t.total?'bd-green':'bd-amber'}">${t.estado||'Activo'}</span></td>
    <td><div class="d-flex gap-1"><button class="btn-ico" onclick="editarTarea('${t.titulo}')" aria-label="Editar"><i class="bi bi-pencil"></i></button><button class="btn-ico" onclick="eliminarTarea('${t.titulo}')" aria-label="Eliminar"><i class="bi bi-trash text-danger"></i></button></div></td>
  </tr>`).join('')}</tbody></table>
</div>`;
}

function filtrarTareas() {
  const q = document.getElementById('srchTarea').value.toLowerCase();
  document.querySelectorAll('#tbTareas tr').forEach(r => { 
    r.style.display = r.textContent.toLowerCase().includes(q)?'':'none'; 
  });
  document.getElementById('tareaCount').textContent = document.querySelectorAll('#tbTareas tr:not([style*="display: none"])').length + ' registros';
}

function renderAdmPagos() {
  const total = DB.pagos.filter(p=>p.estado==='Pagado').reduce((s,p)=>s+p.monto,0);
  const pendiente = DB.pagos.filter(p=>p.estado==='Pendiente').reduce((s,p)=>s+p.monto,0);
  document.getElementById('pageContent').innerHTML = `
<div class="row g-3 mb-4">
  <div class="col-12 col-md-5">
    <div class="acct-hero" style="background:linear-gradient(135deg,#065F46,#059669,#34D399);">
      <div class="hero-type">Resumen Financiero ¬∑ Febrero 2026</div>
      <div class="hero-num">INSTITUTO SAN MARCOS</div>
      <div class="hero-name">L ${total.toLocaleString()}</div>
      <div class="hero-meta">
        <div class="hero-kv"><span class="hero-k">Cobrado</span><span class="hero-v">L ${total.toLocaleString()}</span></div>
        <div style="border-left:1px solid rgba(255,255,255,.2);"></div>
        <div class="hero-kv"><span class="hero-k">Pendiente</span><span class="hero-v" style="color:#FCD34D;">L ${pendiente.toLocaleString()}</span></div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-7">
    <div class="card-base h-100">
      <div class="chr"><span class="ct">Registro de Pagos</span></div>
      <table class="tbl"><thead><tr><th>Ref.</th><th>Alumno</th><th>Concepto</th><th>Monto</th><th>Fecha</th><th>Estado</th><th>Acciones</th></tr></thead>
      <tbody>${DB.pagos.map(p=>`<tr>
        <td style="font-family:'JetBrains Mono';font-size:11px;color:var(--muted);">${p.ref}</td>
        <td style="font-weight:700;">${p.alumno}</td>
        <td>${p.concepto}</td>
        <td style="font-weight:700;">L ${p.monto.toLocaleString()}</td>
        <td style="font-size:12px;">${p.fecha}</td>
        <td><span class="bd ${p.estado==='Pagado'?'bd-green':'bd-red'}">${p.estado}</span></td>
        <td><div class="d-flex gap-1"><button class="btn-ico" onclick="editarPago('${p.ref}')" aria-label="Editar"><i class="bi bi-pencil"></i></button><button class="btn-ico" onclick="eliminarPago('${p.ref}')" aria-label="Eliminar"><i class="bi bi-trash text-danger"></i></button></div></td>
      </tr>`).join('')}</tbody></table>
    </div>
  </div>
</div>`;
}

function renderAdmReportes() {
  const alumnosPorRango = {
    '90-100': DB.alumnos.filter(a=>a.promedio>=90).length,
    '80-89': DB.alumnos.filter(a=>a.promedio>=80 && a.promedio<90).length,
    '70-79': DB.alumnos.filter(a=>a.promedio>=70 && a.promedio<80).length,
    '<70': DB.alumnos.filter(a=>a.promedio<70).length
  };
  
  document.getElementById('pageContent').innerHTML = `
<div class="row g-4 mb-4">
  <div class="col-12 col-md-6">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-graph-up me-2" aria-hidden="true"></i>Distribuci√≥n de Promedios</span></div>
      <div class="cbp">
        ${[['90-100','Excelente','bd-green',alumnosPorRango['90-100']],['80-89','Muy Bueno','bd-blue',alumnosPorRango['80-89']],['70-79','Bueno','bd-amber',alumnosPorRango['70-79']],['<70','En Riesgo','bd-red',alumnosPorRango['<70']]].map(([r,l,b,c])=>`
        <div class="d-flex align-items-center gap-3 mb-3">
          <div style="width:55px;font-size:11px;font-weight:700;">${r}</div>
          <div class="prog-wrap" style="flex:1;height:10px;"><div class="prog-bar" style="width:${Math.round(c/DB.alumnos.length*100)}%;background:var(--indigo);height:10px;"></div></div>
          <span class="bd ${b}">${c} alumnos</span>
        </div>`).join('')}
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-download me-2" aria-hidden="true"></i>Exportar Reportes</span></div>
      <div class="cbp d-flex flex-column gap-2">
        <button class="btn-pri w-100" onclick="exportarReporte('calificaciones')"><i class="bi bi-file-earmark-spreadsheet me-2" aria-hidden="true"></i>Calificaciones (Excel)</button>
        <button class="btn-sec w-100" onclick="exportarReporte('asistencia')"><i class="bi bi-file-earmark-pdf me-2" aria-hidden="true"></i>Asistencia General (PDF)</button>
        <button class="btn-sec w-100" onclick="exportarReporte('alumnos')"><i class="bi bi-people me-2" aria-hidden="true"></i>Listado de Alumnos</button>
        <button class="btn-sec w-100" onclick="exportarReporte('docentes')"><i class="bi bi-person-badge me-2" aria-hidden="true"></i>Informe de Docentes</button>
        <button class="btn-sec w-100" onclick="exportarReporte('pagos')"><i class="bi bi-cash-stack me-2" aria-hidden="true"></i>Reporte Financiero</button>
      </div>
    </div>
  </div>
</div>
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-award me-2" aria-hidden="true"></i>Top Alumnos por Promedio</span></div>
  <table class="tbl"><thead><tr><th>#</th><th>Alumno</th><th>Grado</th><th>Promedio</th><th>Asistencia</th></tr></thead>
  <tbody>${[...DB.alumnos].sort((a,b)=>b.promedio-a.promedio).slice(0,5).map((a,i)=>`<tr>
    <td><span style="font-size:18px;font-weight:800;color:${i===0?'#F59E0B':i===1?'#94A3B8':i===2?'#CD7F32':'var(--muted)'};">${i+1}</span></td>
    <td style="font-weight:700;">${a.nombre}</td>
    <td>${a.grado}</td>
    <td style="font-weight:800;font-size:16px;color:var(--green);">${a.promedio}</td>
    <td><span class="bd bd-green">${a.asistencia}%</span></td>
  </tr>`).join('')}</tbody></table>
</div>`;
}

function renderAvisosMgr() {
  document.getElementById('pageContent').innerHTML = `
<div class="row g-4">
  <div class="col-12 col-md-5">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-megaphone me-2" aria-hidden="true"></i>Publicar Aviso</span></div>
      <div class="cbp">
        <div class="mb-3"><label for="avisoRapTit" class="form-label">T√≠tulo</label><input id="avisoRapTit" class="form-control" placeholder="Ej. Reuni√≥n de Padres..."></div>
        <div class="mb-3"><label for="avisoRapTipo" class="form-label">Tipo</label><select id="avisoRapTipo" class="form-select"><option>Aviso</option><option>Examen</option><option>Evento</option><option>Importante</option></select></div>
        <div class="mb-3"><label for="avisoRapFecha" class="form-label">Fecha</label><input id="avisoRapFecha" type="date" class="form-control" value="${new Date().toISOString().split('T')[0]}"></div>
        <div class="mb-3"><label for="avisoRapDest" class="form-label">Dirigido a</label><select id="avisoRapDest" class="form-select"><option>Todos</option><option>Solo Alumnos</option><option>Solo Docentes</option><option>Padres</option></select></div>
        <div class="mb-3"><label for="avisoRapDesc" class="form-label">Descripci√≥n</label><textarea id="avisoRapDesc" class="form-control" rows="3"></textarea></div>
        <button class="btn-pri w-100" onclick="publicarAvisoRapido()"><i class="bi bi-send me-1" aria-hidden="true"></i>Publicar Aviso</button>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-7">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-list-ul me-2" aria-hidden="true"></i>Avisos Publicados</span><span class="bd bd-blue">${DB.avisos.length} activos</span></div>
      ${DB.avisos.map(av=>`
      <div class="notice-item">
        <div class="notice-dot" style="background:${av.color};" aria-hidden="true"></div>
        <div style="flex:1;"><div style="font-size:13px;font-weight:700;">${av.titulo}</div><div style="font-size:11px;color:var(--muted);">${av.fecha} ¬∑ <span class="bd bd-gray">${av.tipo}</span></div><div style="font-size:11px;color:var(--muted);margin-top:2px;">${av.desc}</div></div>
        <div class="d-flex gap-1">
          <button class="btn-ico" onclick="editarAviso('${av.titulo}')" aria-label="Editar"><i class="bi bi-pencil"></i></button>
          <button class="btn-ico" onclick="eliminarAviso('${av.titulo}')" aria-label="Eliminar"><i class="bi bi-trash" style="color:var(--red);"></i></button>
        </div>
      </div>`).join('')}
    </div>
  </div>
</div>`;
}

function publicarAvisoRapido() {
  const titulo = document.getElementById('avisoRapTit').value.trim();
  const tipo = document.getElementById('avisoRapTipo').value;
  const fechaInput = document.getElementById('avisoRapFecha').value;
  const desc = document.getElementById('avisoRapDesc').value.trim();
  
  if (!titulo || !desc || !fechaInput) {
    toast('Completa t√≠tulo, fecha y descripci√≥n', 'err');
    return;
  }
  
  const fechaParts = fechaInput.split('-');
  const fechaFormateada = `${fechaParts[2]}/${fechaParts[1]}/${fechaParts[0]}`;
  
  DB.avisos.unshift({
    titulo: titulo,
    fecha: fechaFormateada,
    tipo: tipo,
    color: colorAviso[tipo] || '#4338CA',
    desc: desc
  });
  
  saveToStorage();
  toast('Aviso publicado correctamente', 'ok');
  renderAvisosMgr(); // Recargar la vista
}

function renderConfig() {
  document.getElementById('pageContent').innerHTML = `
<div class="row g-4">
  <div class="col-12 col-md-6">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-building me-2" aria-hidden="true"></i>Datos del Instituto</span></div>
      <div class="cbp row g-3">
        <div class="col-12"><label for="configNombre" class="form-label">Nombre del instituto</label><input id="configNombre" class="form-control" value="Instituto San Marcos"></div>
        <div class="col-12 col-md-6"><label for="configDir" class="form-label">Direcci√≥n</label><input id="configDir" class="form-control" value="Comayagua, Honduras"></div>
        <div class="col-12 col-md-6"><label for="configTel" class="form-label">Tel√©fono</label><input id="configTel" class="form-control" value="504-2772-0000"></div>
        <div class="col-12"><label for="configEmail" class="form-label">Correo institucional</label><input id="configEmail" class="form-control" value="info@isanmarcos.edu"></div>
        <div class="col-12 col-md-6"><label for="configAnio" class="form-label">A√±o escolar activo</label><input id="configAnio" class="form-control" value="2026"></div>
        <div class="col-12 col-md-6"><label for="configPeriodo" class="form-label">Per√≠odo activo</label><select id="configPeriodo" class="form-select"><option>III Parcial</option><option>IV Parcial</option></select></div>
        <div class="col-12"><button class="btn-pri" onclick="guardarConfiguracion()"><i class="bi bi-save me-1" aria-hidden="true"></i>Guardar Cambios</button></div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6">
    <div class="card-base mb-3">
      <div class="chr"><span class="ct"><i class="bi bi-shield-check me-2" aria-hidden="true"></i>Seguridad y Acceso</span></div>
      <div class="cbp d-flex flex-column gap-2">
        <button class="btn-sec w-100" onclick="resetearContrasenas()"><i class="bi bi-key me-2" aria-hidden="true"></i>Resetear contrase√±as</button>
        <button class="btn-sec w-100" onclick="crearBackup()"><i class="bi bi-cloud-upload me-2" aria-hidden="true"></i>Crear copia de seguridad</button>
        <button class="btn-sec w-100" onclick="verLogAccesos()"><i class="bi bi-journal-code me-2" aria-hidden="true"></i>Ver log de accesos</button>
      </div>
    </div>
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-palette me-2" aria-hidden="true"></i>Apariencia</span></div>
      <div class="cbp row g-3">
        <div class="col-12"><label class="form-label">Color institucional</label>
          <div class="d-flex gap-2 mt-1" role="group" aria-label="Selector de color">
            ${['#4338CA','#059669','#D97706','#DC2626','#7C3AED','#0891B2'].map(c=>`<button onclick="cambiarColor('${c}')" style="width:28px;height:28px;border-radius:50%;background:${c};cursor:pointer;border:2px solid ${c==='#4338CA'?'#1e1b4b':'transparent'};" aria-label="Color ${c}"></button>`).join('')}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>`;
}

function guardarConfiguracion() {
  toast('Configuraci√≥n guardada correctamente', 'ok');
}

function resetearContrasenas() {
  toast('Contrase√±as reseteadas a todos los usuarios', 'warn');
}

function crearBackup() {
  toast('Copia de seguridad creada', 'ok');
}

function verLogAccesos() {
  toast('Log de accesos descargado', 'ok');
}

function cambiarColor(color) {
  document.documentElement.style.setProperty('--indigo', color);
  toast('Color aplicado', 'ok');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   VISTAS COMPARTIDAS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderAvisosView() {
  document.getElementById('pageContent').innerHTML = `
<div class="row g-3">
${DB.avisos.map(av=>`
<div class="col-12 col-md-6">
  <div class="card-base">
    <div class="cbp d-flex gap-3">
      <div style="width:10px;height:10px;border-radius:50%;background:${av.color};margin-top:5px;flex-shrink:0;" aria-hidden="true"></div>
      <div>
        <div style="font-size:14px;font-weight:800;">${av.titulo}</div>
        <div style="font-size:12px;color:var(--muted);margin-top:2px;">${av.fecha} ¬∑ <span class="bd bd-gray">${av.tipo}</span></div>
        <div style="font-size:12px;margin-top:6px;">${av.desc}</div>
      </div>
    </div>
  </div>
</div>`).join('')}
</div>`;
}

function renderHorario() {
  const horas = ['7:00','8:00','9:00','10:00','Recreo','11:00','12:00'];
  const dias = ['Lunes','Martes','Mi√©rcoles','Jueves','Viernes'];
  const mat = [
    [['sc-mat','Matem√°ticas'],['sc-cien','Ciencias'],['sc-hist','Historia'],['sc-mat','Matem√°ticas'],['sc-ing','Ingl√©s']],
    [['sc-esp','Espa√±ol'],['sc-mat','Matem√°ticas'],['sc-ing','Ingl√©s'],['sc-cien','Ciencias'],['sc-hist','Historia']],
    [['sc-ing','Ingl√©s'],['sc-hist','Historia'],['sc-mat','Matem√°ticas'],['sc-arte','Arte'],['sc-cien','Ciencias']],
    [['sc-rec','‚Äî'],['sc-rec','‚Äî'],['sc-rec','Recreo'],['sc-rec','‚Äî'],['sc-rec','‚Äî']],
    [['sc-cien','Ciencias'],['sc-esp','Espa√±ol'],['sc-arte','Arte'],['sc-ing','Ingl√©s'],['sc-mat','Matem√°ticas']],
    [['sc-hist','Historia'],['sc-arte','Arte'],['sc-cien','Ciencias'],['sc-mat','Matem√°ticas'],['sc-ed','Ed. F√≠sica']],
    [['sc-ed','Ed. F√≠sica'],['sc-ing','Ingl√©s'],['sc-esp','Espa√±ol'],['sc-hist','Historia'],['sc-arte','Arte']],
  ];
  document.getElementById('pageContent').innerHTML = `
<div class="card-base">
  <div class="chr"><span class="ct"><i class="bi bi-calendar3 me-2" aria-hidden="true"></i>Horario de Clases ¬∑ 9¬∞ Grado "B" ¬∑ 2026</span><span class="bd bd-blue">Semana actual</span></div>
  <div class="cbp" style="overflow-x:auto;">
    <div class="sch-grid" style="min-width:520px;" role="grid" aria-label="Horario semanal">
      <div class="sch-head" role="columnheader"></div>${dias.map(d=>`<div class="sch-head" role="columnheader">${d}</div>`).join('')}
      ${horas.map((h,i)=>`<div class="sch-time" role="rowheader">${h}</div>${dias.map((_,di)=>`<div class="sch-cell ${mat[i][di][0]}" role="gridcell">${mat[i][di][1]}</div>`).join('')}`).join('')}
    </div>
    <div class="d-flex flex-wrap gap-2 mt-4" aria-label="Leyenda de materias">
      <span class="bd bd-blue">Matem√°ticas</span><span class="bd bd-green">Ciencias</span>
      <span style="background:#FEF3C7;color:#92400E;font-size:10px;font-weight:700;padding:2px 8px;border-radius:99px;">Historia</span>
      <span style="background:#FCE7F3;color:#9D174D;font-size:10px;font-weight:700;padding:2px 8px;border-radius:99px;">Ingl√©s</span>
      <span style="background:#E0F2FE;color:#075985;font-size:10px;font-weight:700;padding:2px 8px;border-radius:99px;">Ed. F√≠sica</span>
      <span class="bd bd-violet">Arte y Cultura</span><span class="bd" style="background:#FFF7ED;color:#C2410C;">Espa√±ol</span>
    </div>
  </div>
</div>`;
}

function renderMensajes() {
  const mens = [
    {de:'Prof. Ana Mej√≠a',msg:'Recuerda entregar el ejercicio pendiente antes del viernes.',hora:'10:30',ico:'AM',cls:'uav-maestro',leido:false},
    {de:'Direcci√≥n Acad√©mica',msg:'Se modific√≥ el horario de ex√°menes del III Parcial.',hora:'09:15',ico:'DA',cls:'uav-admin',leido:false},
    {de:'Prof. Miguel Soto',msg:'El trabajo grupal de Historia debe entregarse en f√≠sico.',hora:'Ayer',ico:'MS',cls:'uav-maestro',leido:true},
  ];
  document.getElementById('pageContent').innerHTML = `
<div class="row g-4">
  <div class="col-12 col-md-4">
    <div class="card-base">
      <div class="chr"><span class="ct"><i class="bi bi-inbox me-2" aria-hidden="true"></i>Mensajes</span><span class="bd bd-red">${mens.filter(m=>!m.leido).length}</span></div>
      ${mens.map((m,i)=>`
      <div class="tx-row" style="cursor:pointer;${!m.leido?'background:#F0F9FF;':''}" onclick="verMensaje(${i})" role="button" tabindex="0" aria-label="Mensaje de ${m.de}">
        <div class="user-av ${m.cls}" style="width:32px;height:32px;font-size:11px;">${m.ico}</div>
        <div style="flex:1;min-width:0;"><div style="font-size:12px;font-weight:700;">${m.de}</div><div style="font-size:11px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${m.msg}</div></div>
        <div style="font-size:10px;color:var(--muted);flex-shrink:0;">${m.hora}</div>
      </div>`).join('')}
    </div>
  </div>
  <div class="col-12 col-md-8">
    <div class="card-base">
      <div class="chr"><span class="ct">Mensaje</span></div>
      <div id="msgContent" class="cbp" style="min-height:200px;color:var(--muted);font-size:13px;display:flex;align-items:center;justify-content:center;">Selecciona un mensaje para leerlo</div>
      <div style="padding:12px 17px;border-top:1px solid var(--border);">
        <div class="d-flex gap-2"><textarea id="respuestaMsg" class="form-control" rows="2" placeholder="Escribe tu respuesta..." style="resize:none;" aria-label="Escribir respuesta"></textarea><button class="btn-pri" onclick="enviarRespuesta()"><i class="bi bi-send" aria-hidden="true"></i><span class="sr-only">Enviar respuesta</span></button></div>
      </div>
    </div>
  </div>
</div>`;
}

function verMensaje(idx) {
  const mensajes = [
    {de:'Prof. Ana Mej√≠a',msg:'Recuerda entregar el ejercicio pendiente antes del viernes.',hora:'10:30',completo:'Recuerda que el ejercicio de √°lgebra sobre ecuaciones cuadr√°ticas debe entregarse antes del viernes a las 3:00 PM en mi oficina.'},
    {de:'Direcci√≥n Acad√©mica',msg:'Se modific√≥ el horario de ex√°menes del III Parcial.',hora:'09:15',completo:'Por ajustes en el calendario, los ex√°menes del III Parcial se trasladan una semana. Las nuevas fechas ser√°n publicadas en avisos.'},
    {de:'Prof. Miguel Soto',msg:'El trabajo grupal de Historia debe entregarse en f√≠sico.',hora:'Ayer',completo:'Recuerden que el trabajo sobre la Guerra Fr√≠a debe entregarse en f√≠sico, no se aceptar√°n archivos digitales.'},
  ];
  const m = mensajes[idx];
  document.getElementById('msgContent').innerHTML = `
    <div style="width:100%;">
      <div style="font-size:14px;font-weight:800;margin-bottom:8px;">${m.de}</div>
      <div style="color:var(--muted);font-size:12px;">${m.hora}</div>
      <hr style="margin:12px 0;">
      <div style="font-size:13px;line-height:1.6;">${m.completo}</div>
    </div>
  `;
}

function enviarRespuesta() {
  const respuesta = document.getElementById('respuestaMsg').value.trim();
  if (!respuesta) {
    toast('Escribe un mensaje', 'warn');
    return;
  }
  toast('Mensaje enviado', 'ok');
  document.getElementById('respuestaMsg').value = '';
}

function verDetalleAlumno(codigo) {
  verAlumnoModal(codigo);
}

function editarCalificacion(codigo) {
  toast(`Editando calificaci√≥n para alumno ${codigo}`, 'warn');
}

function verDetallePago(ref) {
  toast(`Mostrando detalle del pago ${ref}`, 'ok');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FORM SAVE FUNCTIONS (con persistencia)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function guardarAlumno() {
  clearModalErrors('mNAAlert',['na_nom','na_id','na_fec','na_tutor','na_email']);
  const ok = validateRequired([
    ['na_nom','Nombre completo'],['na_id','No. Identidad'],
    ['na_fec','Fecha de nacimiento'],['na_tutor','Nombre del tutor'],['na_email','Correo del tutor']
  ], 'mNAAlert');
  if(!ok) return;
  
  const codigo = '2024-'+String(Math.floor(1000+Math.random()*8999));
  const grado = document.getElementById('na_grado').value;
  const seccion = document.getElementById('na_sec').value;
  
  DB.alumnos.push({
    codigo, 
    nombre: document.getElementById('na_nom').value.trim(), 
    grado: `${grado} ${seccion}`,
    promedio: 0, 
    asistencia: 100, 
    estado: 'Activo', 
    tutor: document.getElementById('na_tutor').value.trim()
  });
  
  saveToStorage();
  modals.mNuevoAlumno.hide();
  setTimeout(()=>{ 
    toast(`Alumno registrado con c√≥digo ${codigo}`,'ok'); 
    if (currentUser?.role === 'admin') renderAdmAlumnos(); 
  }, 350);
}

function guardarDocente() {
  clearModalErrors('mNDAlert',['nd_nom','nd_esp','nd_email']);
  const ok = validateRequired([['nd_nom','Nombre'],['nd_esp','Especialidad'],['nd_email','Correo']],'mNDAlert');
  if(!ok) return;
  
  const hoy = new Date();
  const fechaIngreso = `${hoy.getDate().toString().padStart(2,'0')}/${(hoy.getMonth()+1).toString().padStart(2,'0')}/${hoy.getFullYear()}`;
  
  DB.docentes.push({
    nombre: document.getElementById('nd_nom').value.trim(),
    esp: document.getElementById('nd_esp').value.trim(),
    grados: document.getElementById('nd_grados').value || 'Por asignar',
    email: document.getElementById('nd_email').value.trim(),
    tel: document.getElementById('nd_tel').value || 'No registrado',
    estado: document.getElementById('nd_est').value,
    ingreso: fechaIngreso
  });
  
  saveToStorage();
  modals.mNuevoDocente.hide();
  setTimeout(()=>{ 
    toast('Docente registrado correctamente','ok'); 
    if (currentUser?.role === 'admin') renderAdmDocentes(); 
  }, 350);
}

function guardarCalif() {
  clearModalErrors('mCAAlert',['rc_alum','rc_mat','rc_per','rc_nota']);
  const nota = parseFloat(document.getElementById('rc_nota').value);
  const ok = validateRequired([['rc_alum','Alumno'],['rc_mat','Materia'],['rc_per','Per√≠odo']],'mCAAlert');
  if(!ok) return;
  if(isNaN(nota)||nota<0||nota>100) { 
    fieldErr('rc_nota'); 
    showModalAlert('mCAAlert','La nota debe ser un n√∫mero entre 0 y 100.'); 
    return; 
  }
  
  // Actualizar nota en materias (simulado)
  const materia = document.getElementById('rc_mat').value;
  const materiaObj = DB.materias.find(m => m.nombre === materia);
  if (materiaObj) {
    materiaObj.nota = Math.round((materiaObj.nota + nota) / 2); // Promedio simulado
  }
  
  saveToStorage();
  modals.mCalif.hide();
  setTimeout(() => {
    toast(`Calificaci√≥n de ${nota} registrada correctamente`,'ok');
    if (currentUser?.role === 'admin') renderAdmCalif();
    else if (currentUser?.role === 'maestro') renderMaeCalif();
    else renderAluCalif();
  }, 350);
}

function guardarAviso() {
  clearModalErrors('mAVAlert',['av_tit','av_tipo','av_fec','av_desc']);
  const ok = validateRequired([['av_tit','T√≠tulo'],['av_tipo','Tipo'],['av_fec','Fecha'],['av_desc','Descripci√≥n']],'mAVAlert');
  if(!ok) return;
  
  const fechaInput = document.getElementById('av_fec').value;
  const fechaParts = fechaInput.split('-');
  const fechaFormateada = `${fechaParts[2]}/${fechaParts[1]}/${fechaParts[0]}`;
  
  DB.avisos.unshift({
    titulo: document.getElementById('av_tit').value.trim(),
    fecha: fechaFormateada,
    tipo: document.getElementById('av_tipo').value,
    color: colorAviso[document.getElementById('av_tipo').value] || '#4338CA',
    desc: document.getElementById('av_desc').value.trim()
  });
  
  saveToStorage();
  modals.mAviso.hide();
  setTimeout(() => {
    toast('Aviso publicado a todos los usuarios','ok');
    if (currentUser?.role === 'admin') renderAvisosMgr();
    else renderAvisosView();
  }, 350);
}

function guardarAsistencia() {
  clearModalErrors('mASAlert',['as_alum','as_fec','as_est']);
  const ok = validateRequired([['as_alum','C√≥digo de alumno'],['as_fec','Fecha'],['as_est','Estado']],'mASAlert');
  if(!ok) return;
  
  const fechaInput = document.getElementById('as_fec').value;
  const fechaParts = fechaInput.split('-');
  const fechaFormateada = `${fechaParts[2]}/${fechaParts[1]}/${fechaParts[0]}`;
  const diasSemana = ['Domingo','Lunes','Martes','Mi√©rcoles','Jueves','Viernes','S√°bado'];
  const dia = diasSemana[new Date(fechaInput).getDay()];
  
  DB.asistencia.unshift({
    fecha: fechaFormateada,
    dia: dia,
    estado: document.getElementById('as_est').value,
    obs: document.getElementById('as_obs').value || ''
  });
  
  // Actualizar asistencia del alumno (simulado)
  const codigo = document.getElementById('as_alum').value.trim();
  const alumno = DB.alumnos.find(a => a.codigo === codigo);
  if (alumno) {
    // Simulaci√≥n: bajar asistencia si es ausente
    if (document.getElementById('as_est').value === 'Ausente') {
      alumno.asistencia = Math.max(60, alumno.asistencia - 2);
    }
  }
  
  if (DB.asistencia.length > 50) DB.asistencia = DB.asistencia.slice(0, 50);
  saveToStorage();
  modals.mAsistencia.hide();
  setTimeout(() => {
    toast('Asistencia registrada correctamente','ok');
    if (currentUser?.role === 'admin') renderAdmAsist();
    else if (currentUser?.role === 'maestro') renderMaeAsist();
    else renderAluAsist();
  }, 350);
}

function guardarTarea() {
  clearModalErrors('mTAAlert',['ta_tit','ta_mat','ta_fec','ta_desc']);
  const ok = validateRequired([['ta_tit','T√≠tulo'],['ta_mat','Materia'],['ta_fec','Fecha l√≠mite'],['ta_desc','Descripci√≥n']],'mTAAlert');
  if(!ok) return;
  
  const fechaInput = document.getElementById('ta_fec').value;
  const fechaParts = fechaInput.split('-');
  const fechaFormateada = `${fechaParts[2]}/${fechaParts[1]}/${fechaParts[0]}`;
  
  const nuevaTarea = {
    titulo: document.getElementById('ta_tit').value.trim(),
    materia: document.getElementById('ta_mat').value,
    fecha: fechaFormateada,
    estado: 'Pendiente',
    pts: parseInt(document.getElementById('ta_pts').value) || 10,
    grado: document.getElementById('ta_grado').value,
    desc: document.getElementById('ta_desc').value.trim()
  };
  
  if (currentUser?.role === 'maestro') {
    DB.tareas.push(nuevaTarea);
  } else {
    DB.tareas.push(nuevaTarea);
  }
  
  saveToStorage();
  modals.mTarea.hide();
  setTimeout(() => {
    toast('Tarea asignada correctamente','ok');
    if (currentUser?.role === 'admin') renderAdmTareas();
    else if (currentUser?.role === 'maestro') renderMaeTareas();
    else renderAluTareas();
  }, 350);
}

</script>
</body>
</html>